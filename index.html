<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovusFace AI // GOD_MODE</title>
    
    <meta name="description" content="Immersive Neural Interface for Professional AI Face Swapping. God-Tier visuals. Zero Latency.">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%23000'/%3E%3Ctext x='50' y='70' font-family='Orbitron' font-weight='900' font-size='50' fill='%2300ffcc' text-anchor='middle'%3ENF%3C/text%3E%3C/svg%3E">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;900&family=JetBrains+Mono&family=Orbitron:wght@400;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #00ffcc; --bg: #020202; --panel: rgba(5,5,5,0.9);
            --border: 1px solid rgba(0, 255, 204, 0.2); --radius: 0px;
            --glow: 0 0 25px rgba(0, 255, 204, 0.3);
        }

        /* 15 NEURAL DIMENSIONS (GOD_MODE COLORS) */
        [data-theme="cyber"] { --primary: #00f3ff; --bg: #000508; }
        [data-theme="desire"] { --primary: #ff0055; --bg: #0a0002; --radius: 50px; }
        [data-theme="matrix"] { --primary: #00ff00; --bg: #000; --radius: 0px; }
        [data-theme="royal"] { --primary: #ffd700; --bg: #050500; --radius: 15px; }
        [data-theme="glacier"] { --primary: #7df9ff; --bg: #f0ffff; --panel: rgba(255,255,255,0.1); }
        [data-theme="void"] { --primary: #ffffff; --bg: #000; --radius: 0px; }

        body { 
            background: var(--bg); color: #fff; font-family: 'Orbitron', sans-serif; 
            margin: 0; overflow: hidden; height: 100vh;
            perspective: 2000px;
        }

        canvas#neural { position: fixed; top: 0; left: 0; z-index: -1; }

        /* THE SIDEBAR COMMAND CENTER */
        .sidebar { 
            position: fixed; top: 0; right: 0; width: 420px; height: 100%; 
            background: rgba(0,0,0,0.98); border-left: var(--border); 
            transform: translateX(100%); transition: 0.6s cubic-bezier(0.19, 1, 0.22, 1);
            z-index: 2000; padding: 30px; backdrop-filter: blur(40px);
            box-shadow: -20px 0 50px rgba(0,0,0,0.9);
        }
        .sidebar.active { transform: translateX(0); }
        
        .menu-trigger {
            position: fixed; top: 30px; right: 30px; z-index: 2001;
            cursor: pointer; padding: 10px; border: var(--border);
            background: var(--panel); color: var(--primary); font-size: 1.5rem;
            transition: 0.3s;
        }
        .menu-trigger:hover { box-shadow: var(--glow); transform: scale(1.1); }

        /* THE GOD PANEL */
        .container { 
            height: 100vh; display: flex; align-items: center; justify-content: center;
            transform-style: preserve-3d;
        }
        
        .god-panel { 
            width: 850px; background: var(--panel); border: var(--border);
            border-radius: var(--radius); padding: 50px;
            box-shadow: var(--glow), inset 0 0 50px rgba(0, 255, 204, 0.05);
            backdrop-filter: blur(20px); transition: 0.1s linear;
        }

        .nf-header { text-align: center; margin-bottom: 40px; }
        .glitch-text { 
            font-size: 2.5rem; font-weight: 900; letter-spacing: 15px;
            color: var(--primary); text-shadow: var(--glow);
            position: relative; display: inline-block;
        }

        /* BIO-REACTIVE UPLOAD BLOCKS */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 40px 0; }
        .u-block {
            height: 200px; border: 1px solid rgba(255,255,255,0.05);
            background: rgba(255,255,255,0.02); cursor: pointer;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative; overflow: hidden; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .u-block:hover { 
            border-color: var(--primary); background: rgba(0, 255, 204, 0.05);
            transform: translateZ(50px);
        }
        .u-block p { font-size: 0.7rem; letter-spacing: 4px; color: #555; transition: 0.3s; }
        .u-block:hover p { color: var(--primary); }
        .u-block img { position: absolute; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: 0.5s; }
        .u-block.ready img { opacity: 1; }

        /* ACTION BUTTONS */
        .btn-god {
            width: 100%; padding: 20px; background: var(--primary); color: #000;
            border: none; font-family: 'Orbitron'; font-weight: 900; font-size: 1rem;
            letter-spacing: 8px; cursor: pointer; transition: 0.4s;
            clip-path: polygon(5% 0%, 100% 0%, 95% 100%, 0% 100%);
        }
        .btn-god:hover { 
            letter-spacing: 12px; filter: brightness(1.2); 
            box-shadow: 0 0 30px var(--primary);
        }

        .face-selector-strip {
            display: flex; gap: 15px; overflow-x: auto; padding: 20px 0;
            border-top: 1px solid rgba(255,255,255,0.1); margin-top: 20px;
        }
        .face-node {
            width: 70px; height: 70px; border-radius: 50%; border: 3px solid transparent;
            cursor: pointer; transition: 0.3s; background-size: cover; flex-shrink: 0;
        }
        .face-node.active { border-color: var(--primary); box-shadow: var(--glow); transform: scale(1.1); }

        /* VAULT & THEME OPTIONS */
        .vault-item { 
            aspect-ratio: 1/1; border: 1px solid #111; cursor: pointer; 
            transition: 0.3s; filter: grayscale(1);
        }
        .vault-item:hover { filter: grayscale(0); border-color: var(--primary); }

        #status-log { font-family: 'JetBrains Mono'; font-size: 10px; color: #444; margin-top: 20px; text-align: center; }
    </style>
</head>
<body data-theme="cyber">

<canvas id="neural"></canvas>
<div class="menu-trigger" onclick="document.querySelector('.sidebar').classList.toggle('active')">â–¤</div>

<div class="sidebar">
    <h2 style="font-size: 1rem; letter-spacing: 5px; color: var(--primary);">SYSTEM_PROFILE</h2>
    <input type="text" id="opName" style="background:none; border:none; color:#fff; font-size:1.5rem; font-family:'Orbitron'; outline:none; border-bottom:1px solid #333; width:100%;" value="GOD_OPERATOR">
    
    <div style="margin-top: 40px;">
        <p style="font-size: 10px; color: #444;">IDENTITY_VAULT</p>
        <div id="vault" class="vault-grid" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:5px;"></div>
    </div>

    <div style="margin-top: 40px;">
        <p style="font-size: 10px; color: #444;">DIMENSION_MATRIX</p>
        <div id="themes" style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;"></div>
    </div>
</div>

<div class="container">
    <div class="god-panel" id="panel">
        <div class="nf-header">
            <div class="glitch-text" id="logo">NOVUSFACE</div>
            <p id="status-log">>> INITIALIZING NEURAL CORE...</p>
        </div>

        <div class="grid">
            <div class="u-block" onclick="document.getElementById('srcIn').click()">
                <p>SOURCE_IDENTITY</p>
                <input type="file" id="srcIn" hidden onchange="handleSrc(this)">
                <img id="sp">
            </div>
            <div class="u-block" onclick="document.getElementById('tgtIn').click()">
                <p>TARGET_MATRIX</p>
                <input type="file" id="tgtIn" hidden onchange="handleTgt(this)">
                <img id="tp">
            </div>
        </div>

        <div id="selection-zone" style="display:none;">
            <p style="font-size: 9px; color: #555;">NEURAL_MAPPING_TARGETS:</p>
            <div id="faceStrip" class="face-selector-strip"></div>
        </div>

        <button class="btn-god" onclick="startTheSwap()">GENERATE NEURAL SWAP</button>

        <div id="result-view" style="display:none; margin-top: 40px; text-align: center;">
            <div style="padding: 15px; border: 1px solid var(--primary); display: inline-block;">
                <img id="ri" style="max-width: 100%; height: auto; display: block;">
            </div>
            <br>
            <a id="db" class="btn-god" style="display:inline-block; margin-top: 20px; text-decoration: none; width: auto; padding: 15px 50px;" download="god_mode_swap.png">EXTRACT_MEDIA</a>
        </div>
    </div>
</div>

<script>
    const API = "https://codewander-666-novusface-backend.hf.space";
    let activeFace = 0, db;

    // --- GOD MODE BACKGROUND ENGINE ---
    const canvas = document.getElementById('neural');
    const ctx = canvas.getContext('2d');
    let pts = [];

    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.onresize = resize; resize();

    for(let i=0; i<80; i++) pts.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, vx:Math.random()*1-0.5, vy:Math.random()*1-0.5, b:Math.random()*100});

    function render() {
        ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--bg');
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--primary');
        ctx.lineWidth = 0.5;

        pts.forEach(p => {
            p.x += p.vx; p.y += p.vy;
            if(p.x<0 || p.x>canvas.width) p.vx*=-1;
            if(p.y<0 || p.y>canvas.height) p.vy*=-1;
            
            p.b++;
            if(p.b > 200) { // Neural Pulse Effect
                ctx.beginPath(); ctx.arc(p.x, p.y, 4, 0, Math.PI*2); 
                ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--primary');
                ctx.fill(); p.b = 0;
            }

            pts.forEach(p2 => {
                let d = Math.hypot(p.x-p2.x, p.y-p2.y);
                if(d < 150) {
                    ctx.globalAlpha = 1 - (d/150);
                    ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(p2.x, p2.y); ctx.stroke();
                }
            });
        });
        ctx.globalAlpha = 1;
        requestAnimationFrame(render);
    }
    render();

    // --- HYBRID PERSISTENCE ---
    const request = indexedDB.open("NovusGod", 1);
    request.onupgradeneeded = (e) => e.target.result.createObjectStore("vault", {keyPath:"id", autoIncrement:true});
    request.onsuccess = (e) => { db = e.target.result; updateVault(); };

    function saveToVault(blob) {
        db.transaction("vault","readwrite").objectStore("vault").add({blob, date: Date.now()});
        updateVault();
    }

    function updateVault() {
        const v = document.getElementById('vault'); v.innerHTML = "";
        db.transaction("vault").objectStore("vault").openCursor(null, "prev").onsuccess = (e) => {
            const c = e.target.result;
            if(c) {
                const u = URL.createObjectURL(c.value.blob);
                const img = document.createElement('div'); img.className="vault-item";
                img.innerHTML = `<img src="${u}" style="width:100%; height:100%; object-fit:cover;">`;
                img.onclick = () => { document.getElementById('sp').src=u; document.getElementById('sp').parentNode.classList.add('ready'); window.currentSource = c.value.blob; };
                v.appendChild(img); c.continue();
            }
        };
    }

    // --- CORE LOGIC ---
    function handleSrc(i) {
        if(i.files[0]) {
            const u = URL.createObjectURL(i.files[0]);
            document.getElementById('sp').src = u;
            document.getElementById('sp').parentNode.classList.add('ready');
            window.currentSource = i.files[0];
            saveToVault(i.files[0]);
        }
    }

    async function handleTgt(i) {
        const f = i.files[0];
        document.getElementById('tp').src = URL.createObjectURL(f);
        document.getElementById('tp').parentNode.classList.add('ready');
        document.getElementById('status-log').innerText = ">> SCANNING BIOMETRIC NODES...";
        
        const fd = new FormData(); fd.append('target', f);
        const r = await fetch(`${API}/detect-target-faces`, {method:'POST', body:fd});
        const d = await r.json();
        
        const strip = document.getElementById('faceStrip'); strip.innerHTML = "";
        document.getElementById('selection-zone').style.display = "block";
        
        d.faces.forEach((face, idx) => {
            const node = document.createElement('div');
            node.className = `face-node ${idx===0?'active':''}`;
            node.style.backgroundImage = `url(${face.thumbnail})`;
            node.onclick = () => {
                activeFace = face.face_id;
                document.querySelectorAll('.face-node').forEach(n=>n.classList.remove('active'));
                node.classList.add('active');
            };
            strip.appendChild(node);
        });
        activeFace = d.faces[0].face_id;
        document.getElementById('status-log').innerText = ">> NODES MAPPED. READY FOR SWAP.";
    }

    async function startTheSwap() {
        const s = window.currentSource, t = document.getElementById('tgtIn').files[0];
        if(!s || !t) return alert("NO IDENTITY DETECTED.");
        document.getElementById('status-log').innerText = ">> INJECTING NEURAL STRAND...";
        
        const fd = new FormData(); fd.append('source', s); fd.append('target', t); fd.append('target_face_id', activeFace);
        try {
            const res = await fetch(`${API}/swap`, {method:'POST', body:fd});
            const b = await res.blob(); const u = URL.createObjectURL(b);
            document.getElementById('ri').src = u; document.getElementById('db').href = u;
            document.getElementById('result-view').style.display = "block";
            document.getElementById('status-log').innerText = ">> INJECTION SUCCESSFUL.";
        } catch(e) { document.getElementById('status-log').innerText = ">> SYSTEM CRITICAL ERROR."; }
    }

    // DIMENSION MATRIX (THEMES)
    const ths = ['cyber','desire','matrix','royal','glacier','void'];
    ths.forEach(t => {
        const b = document.createElement('div'); b.className = "t-btn";
        b.style = "padding:10px; border:1px solid #111; cursor:pointer; font-size:9px; text-align:center;";
        b.innerText = t.toUpperCase();
        b.onclick = () => document.body.setAttribute('data-theme', t);
        document.getElementById('themes').appendChild(b);
    });

    // 3D MOTION SHADER
    document.addEventListener('mousemove', (e) => {
        let x = (window.innerWidth / 2 - e.pageX) / 50;
        let y = (window.innerHeight / 2 - e.pageY) / 50;
        document.getElementById('panel').style.transform = `rotateY(${x}deg) rotateX(${y}deg)`;
    });
</script>
</body>
</html>
