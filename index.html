<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NOVUSFACE AI - Ultimate Suite v8.0</title>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%23000'/%3E%3Ctext x='50' y='70' font-family='sans-serif' font-weight='900' font-size='50' fill='%2300f3ff' text-anchor='middle'%3ENF%3C/text%3E%3C/svg%3E">

    <meta name="description" content="Professional face swapping with forensic accuracy. Features Image, Batch, and Video swapping with 11D neural injection.">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=JetBrains+Mono:wght@300;700&family=Orbitron:wght@400;700;900&family=Inter:wght@300;600&display=swap" rel="stylesheet">

    <style>
        /* --- [CORE_CSS_VARIABLES] --- */
        :root {
            --hue: 180; --sat: 100%; --lig: 50%;
            --primary: hsl(var(--hue), var(--sat), var(--lig));
            --secondary: #ff00ff;
            --bg-deep: #020202;
            --bg-panel: rgba(10, 15, 20, 0.85);
            --text-main: #fff;
            --text-dim: #889;
            --border: 1px solid rgba(255, 255, 255, 0.1);
            --font-head: 'Orbitron', sans-serif;
            --font-ui: 'Audiowide', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
            --scanline-opt: 0.05;
        }

        /* --- [THEME_DEFINITIONS] --- */
        /* NEON */
        [data-theme="cyberpunk"] { --hue: 180; --secondary: #ff00ff; --bg-deep: #050510; }
        [data-theme="neon_tokyo"] { --hue: 300; --secondary: #00ffff; --bg-deep: #100010; }
        [data-theme="synthwave"] { --hue: 280; --secondary: #ff71ce; --bg-deep: #150020; }
        /* NATURE */
        [data-theme="deep_ocean"] { --hue: 210; --secondary: #00ffaa; --bg-deep: #000510; }
        [data-theme="forest_king"] { --hue: 120; --secondary: #ddff00; --bg-deep: #051005; }
        [data-theme="volcano"] { --hue: 10; --secondary: #ffaa00; --bg-deep: #100500; }
        /* MINIMAL */
        [data-theme="obsidian"] { --hue: 0; --sat: 0%; --lig: 100%; --secondary: #666; --bg-deep: #000; }
        [data-theme="midnight"] { --hue: 240; --sat: 50%; --lig: 70%; --secondary: #444; --bg-deep: #0a0a0a; }
        
        /* --- [LAYOUT_RESET] --- */
        * { box-sizing: border-box; outline: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg-deep); color: var(--text-main); font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; display: flex; transition: background 0.5s; }
        
        #anim-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.4; }
        #crt-overlay { position: fixed; inset: 0; background: linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.1) 50%); background-size: 100% 4px; pointer-events: none; z-index: 9999; opacity: var(--scanline-opt); }

        /* --- [SIDEBAR] --- */
        .sidebar { width: 80px; background: rgba(0,0,0,0.6); backdrop-filter: blur(10px); border-right: var(--border); display: flex; flex-direction: column; align-items: center; padding: 20px 0; z-index: 100; transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .sidebar:hover { width: 240px; }
        .brand { width: 50px; height: 50px; border: 2px solid var(--primary); display: flex; align-items: center; justify-content: center; font-family: var(--font-head); font-weight: 900; font-size: 24px; color: var(--primary); margin-bottom: 40px; box-shadow: 0 0 15px var(--primary); transition: 0.3s; cursor: pointer; }
        .sidebar:hover .brand { width: 100%; border: none; box-shadow: none; text-shadow: 0 0 10px var(--primary); }
        .brand span { display: none; margin-left: 10px; font-size: 18px; letter-spacing: 2px; }
        .sidebar:hover .brand span { display: inline; }

        .nav-item { width: 100%; height: 60px; display: flex; align-items: center; padding: 0 25px; cursor: pointer; color: var(--text-dim); transition: 0.2s; position: relative; overflow: hidden; }
        .nav-item:hover, .nav-item.active { color: var(--text-main); background: linear-gradient(90deg, rgba(var(--hue), 255, 255, 0.1), transparent); }
        .nav-item::before { content: ''; position: absolute; left: 0; top: 0; height: 100%; width: 3px; background: var(--primary); transform: scaleY(0); transition: 0.2s; }
        .nav-item.active::before { transform: scaleY(1); }
        .nav-icon { font-size: 20px; width: 30px; text-align: center; }
        .nav-label { margin-left: 15px; font-family: var(--font-ui); font-size: 12px; opacity: 0; transition: 0.2s; white-space: nowrap; }
        .sidebar:hover .nav-label { opacity: 1; }

        /* --- [WORKSPACE] --- */
        .workspace { flex: 1; padding: 30px; overflow-y: auto; overflow-x: hidden; position: relative; scrollbar-width: none; }
        .workspace::-webkit-scrollbar { display: none; }
        
        .widget-container { display: none; animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); max-width: 1200px; margin: 0 auto; }
        .widget-container.active { display: block; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .panel { background: var(--bg-panel); border: var(--border); padding: 25px; border-radius: 4px; position: relative; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .panel h2 { font-family: var(--font-head); margin-top: 0; color: var(--primary); letter-spacing: 2px; font-size: 1.2rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; }
        
        /* --- [COMPONENTS] --- */
        .btn { background: transparent; border: 1px solid var(--primary); color: var(--primary); padding: 12px 24px; font-family: var(--font-ui); text-transform: uppercase; cursor: pointer; transition: 0.3s; position: relative; overflow: hidden; font-size: 0.8rem; letter-spacing: 1px; }
        .btn:hover { background: var(--primary); color: #000; box-shadow: 0 0 20px var(--primary); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }
        .btn-danger { border-color: red; color: red; } .btn-danger:hover { background: red; color: #fff; box-shadow: 0 0 20px red; }
        
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-family: var(--font-mono); font-size: 10px; color: var(--secondary); margin-bottom: 8px; letter-spacing: 1px; }
        input[type="text"], input[type="file"], select { width: 100%; background: rgba(0,0,0,0.5); border: 1px solid #333; color: #fff; padding: 12px; font-family: var(--font-mono); transition: 0.3s; }
        
        .upload-zone { height: 300px; border: 2px dashed #333; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; position: relative; overflow: hidden; background: rgba(0,0,0,0.2); }
        .upload-zone:hover { border-color: var(--secondary); background: rgba(255, 0, 255, 0.05); }
        .upload-zone img, .upload-zone video { width: 100%; height: 100%; object-fit: contain; z-index: 2; display: none; }
        .upload-zone.has-media img, .upload-zone.has-media video { display: block; }
        .upload-zone .placeholder { text-align: center; color: #555; z-index: 1; pointer-events: none; }
        .upload-zone .placeholder i { font-size: 40px; margin-bottom: 10px; display: block; }

        /* --- [GRIDS & LISTS] --- */
        .swap-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .history-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .history-item { aspect-ratio: 1; background: #000; border: 1px solid #333; position: relative; cursor: pointer; transition: 0.3s; overflow: hidden; }
        .history-item img, .history-item video { width: 100%; height: 100%; object-fit: cover; }
        .history-item:hover { border-color: var(--primary); transform: scale(1.02); }
        
        .face-selector { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; border-top: 1px solid #333; margin-top: 10px; min-height: 70px; }
        .face-thumb { width: 50px; height: 50px; border-radius: 50%; border: 2px solid #333; flex-shrink: 0; background-size: cover; cursor: pointer; transition: 0.2s; }
        .face-thumb.selected { border-color: var(--primary); transform: scale(1.1); box-shadow: 0 0 10px var(--primary); }

        .batch-list { max-height: 150px; overflow-y: auto; background: rgba(0,0,0,0.5); padding: 10px; border: 1px solid #333; margin-top: 10px; font-family: var(--font-mono); font-size: 0.8rem; }
        .batch-item { display: flex; justify-content: space-between; padding: 5px; border-bottom: 1px solid #222; }
        
        .progress-container { margin-top: 20px; background: rgba(0,0,0,0.5); padding: 15px; border: 1px solid var(--secondary); display: none; }
        .progress-bar-track { width: 100%; height: 4px; background: #333; margin-top: 10px; position: relative; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--secondary); width: 0%; transition: width 0.3s; box-shadow: 0 0 10px var(--secondary); }
        .progress-stats { display: flex; justify-content: space-between; font-family: var(--font-mono); font-size: 0.7rem; margin-top: 5px; color: var(--text-dim); }

        /* --- [NEW: GIF EDITOR & TAGS] --- */
        .gif-tags { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
        .gif-tag { background: rgba(255,255,255,0.05); border: 1px solid #333; padding: 8px 15px; border-radius: 20px; font-family: var(--font-mono); font-size: 0.8rem; cursor: pointer; transition: 0.2s; color: #aaa; }
        .gif-tag:hover { border-color: var(--primary); color: #fff; background: rgba(0, 243, 255, 0.1); }
        .gif-container { position: relative; display: inline-block; max-width: 100%; }
        .gif-text-overlay {
            position: absolute; left: 50%; transform: translateX(-50%); width: 100%;
            text-align: center; font-family: 'Impact', sans-serif;
            color: white; font-size: 2rem; line-height: 1;
            text-shadow: 2px 2px 0 #000, -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000;
            text-transform: uppercase; pointer-events: none; z-index: 10;
        }
        #overlay-top { top: 10px; }
        #overlay-bot { bottom: 10px; }

        /* --- [NEW: HIERARCHICAL THEME BROWSER] --- */
        .theme-browser { display: flex; height: 500px; border: 1px solid #333; background: rgba(0,0,0,0.3); }
        .cat-list { width: 30%; border-right: 1px solid #333; overflow-y: auto; background: rgba(0,0,0,0.2); }
        .cat-item { padding: 15px; cursor: pointer; border-left: 3px solid transparent; font-family: var(--font-ui); font-size: 0.8rem; color: #888; transition: 0.2s; }
        .cat-item:hover, .cat-item.active { background: rgba(255,255,255,0.05); color: #fff; border-left-color: var(--primary); }
        .sub-cat-view { flex: 1; padding: 20px; overflow-y: auto; }
        .sub-cat-group { margin-bottom: 25px; }
        .sub-cat-title { font-family: var(--font-head); color: var(--secondary); margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; font-size: 0.9rem; letter-spacing: 1px; }
        .theme-grid-mini { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 10px; }
        .theme-mini { aspect-ratio: 1.4; border: 1px solid #444; cursor: pointer; position: relative; overflow: hidden; transition: 0.2s; }
        .theme-mini:hover { border-color: var(--primary); transform: translateY(-2px); }
        .theme-mini-preview { height: 75%; width: 100%; }
        .theme-mini-name { font-size: 0.6rem; padding: 0 5px; text-align: center; background: #111; height: 25%; display: flex; align-items: center; justify-content: center; color: #ccc; font-family: var(--font-mono); }

        /* --- [LOADER] --- */
        .loader-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 999; display: none; align-items: center; justify-content: center; flex-direction: column; backdrop-filter: blur(5px); }
        .scanner-bar { width: 300px; height: 4px; background: #333; position: relative; overflow: hidden; margin-top: 20px; }
        .scanner-bar::after { content: ''; position: absolute; top: 0; left: 0; height: 100%; width: 50%; background: var(--primary); animation: scan 1s infinite linear; box-shadow: 0 0 20px var(--primary); }
        @keyframes scan { 0% { left: -50%; } 100% { left: 100%; } }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .sidebar { position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; flex-direction: row; border-right: none; border-top: var(--border); padding: 0; overflow-x: auto; justify-content: flex-start; }
            .sidebar:hover { width: 100%; height: 60px; }
            .brand { display: none; }
            .nav-item { min-width: 60px; flex-direction: column; justify-content: center; padding: 0; }
            .nav-label { display: none !important; }
            .nav-icon { font-size: 24px; }
            .workspace { padding-bottom: 80px; }
            .swap-grid { grid-template-columns: 1fr; }
            .theme-browser { flex-direction: column; height: auto; }
            .cat-list { width: 100%; height: 150px; border-right: none; border-bottom: 1px solid #333; }
        }
    </style>
</head>
<body>

    <div id="crt-overlay"></div>
    <canvas id="anim-canvas"></canvas>

    <div id="global-loader" class="loader-overlay">
        <div style="font-family: var(--font-head); font-size: 2rem; color: var(--primary);">NOVUSFACE AI</div>
        <div class="scanner-bar"></div>
        <div id="loader-text" style="font-family: var(--font-mono); margin-top: 10px; color: var(--text-dim);">INITIALIZING NEURAL CORE...</div>
    </div>

    <nav class="sidebar">
        <div class="brand">NF<span>NOVUSFACE</span></div>
        <div class="nav-item active" onclick="app.nav('swap')">
            <div class="nav-icon">‚ö°</div>
            <div class="nav-label">IMAGE SWAP</div>
        </div>
        <div class="nav-item" onclick="app.nav('batch')">
            <div class="nav-icon">üìä</div>
            <div class="nav-label">BATCH SWAP</div>
        </div>
        <div class="nav-item" onclick="app.nav('video')">
            <div class="nav-icon">üé¨</div>
            <div class="nav-label">VIDEO SWAP</div>
        </div>
        <div class="nav-item" onclick="app.nav('gif')">
            <div class="nav-icon">üëæ</div>
            <div class="nav-label">AI GIF MAKER</div>
        </div>
        <div class="nav-item" onclick="app.nav('vault')">
            <div class="nav-icon">üìÇ</div>
            <div class="nav-label">HISTORY VAULT</div>
        </div>
        <div class="nav-item" onclick="app.nav('themes')">
            <div class="nav-icon">üé®</div>
            <div class="nav-label">THEME MATRIX</div>
        </div>
        <div class="nav-item" onclick="app.nav('profile')">
            <div class="nav-icon">üë§</div>
            <div class="nav-label">PROFILE</div>
        </div>
        <div class="nav-item" onclick="app.nav('status')">
            <div class="nav-icon">üì°</div>
            <div class="nav-label">STATUS</div>
        </div>
        <div class="nav-item" onclick="app.nav('about')">
            <div class="nav-icon">‚ÑπÔ∏è</div>
            <div class="nav-label">ABOUT</div>
        </div>
    </nav>

    <main class="workspace">
        
        <div id="view-swap" class="widget-container active">
            <div class="panel">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h2>IMAGE SWAP ENGINE</h2>
                    <span style="font-family: var(--font-mono); font-size: 0.7rem; color: var(--secondary);">V.4.5.2</span>
                </div>
                <div class="swap-grid">
                    <div>
                        <div class="input-group">
                            <label>01 // SOURCE IDENTITY</label>
                            <div class="upload-zone" id="zone-src" onclick="document.getElementById('in-src').click()">
                                <div class="placeholder"><i>üë§</i>CLICK TO UPLOAD<br>SOURCE FACE</div>
                                <img id="img-src">
                                <input type="file" id="in-src" hidden accept="image/*" onchange="app.handleUpload('src', this)">
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="input-group">
                            <label>02 // TARGET SCENE</label>
                            <div class="upload-zone" id="zone-tgt" onclick="document.getElementById('in-tgt').click()">
                                <div class="placeholder"><i>üñºÔ∏è</i>CLICK TO UPLOAD<br>TARGET IMAGE</div>
                                <img id="img-tgt">
                                <input type="file" id="in-tgt" hidden accept="image/*" onchange="app.handleUpload('tgt', this)">
                            </div>
                            <div id="face-list-container" style="display:none;">
                                <label style="margin-top:10px;">>> DETECTED HOSTS</label>
                                <div class="face-selector" id="face-list"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="input-group" style="margin-top: 20px; background: rgba(0,0,0,0.3); padding: 15px;">
                    <label>03 // ACCURACY WEIGHT (0.0 - 1.0)</label>
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-family:var(--font-mono); font-size:0.8rem;">
                        <span>IDENTITY STRENGTH</span>
                        <span id="acc-val" style="color:var(--primary)">0.70</span>
                    </div>
                    <input type="range" id="rng-acc" min="0" max="1" step="0.05" value="0.70" style="width:100%; accent-color: var(--primary);" oninput="document.getElementById('acc-val').innerText=this.value">
                </div>
                <button class="btn" style="width:100%; font-size:1.2rem; font-weight:900;" onclick="app.executeSwap()">INITIATE SWAP SEQUENCE</button>
                <div id="result-area" style="display:none; margin-top:30px; border-top:1px solid #333; padding-top:20px; text-align:center;">
                    <h3 style="font-family:var(--font-head); color:var(--secondary);">>> OUTPUT MATERIALIZED</h3>
                    <img id="img-res" style="max-width:100%; border:1px solid var(--secondary); box-shadow:0 0 20px rgba(255,0,255,0.2);">
                    <div style="margin-top:15px; display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                        <button class="btn" onclick="app.downloadResult()">DOWNLOAD</button>
                        <button class="btn" onclick="app.saveToVault('image')">SAVE TO VAULT</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-batch" class="widget-container">
            <div class="panel">
                <h2>MATRIX BATCH PROCESSOR</h2>
                <div class="swap-grid">
                    <div>
                        <label>SOURCE ARRAY (MAX 5)</label>
                        <div class="upload-zone" id="zone-batch-src" onclick="document.getElementById('in-batch-src').click()">
                            <div class="placeholder"><i>üë•</i>SELECT MULTIPLE<br>SOURCES</div>
                            <input type="file" id="in-batch-src" hidden multiple accept="image/*" onchange="app.batch.handleFiles('src', this)">
                        </div>
                        <div id="list-batch-src" class="batch-list"></div>
                    </div>
                    <div>
                        <label>TARGET ARRAY (MAX 10)</label>
                        <div class="upload-zone" id="zone-batch-tgt" onclick="document.getElementById('in-batch-tgt').click()">
                            <div class="placeholder"><i>üèôÔ∏è</i>SELECT MULTIPLE<br>TARGETS</div>
                            <input type="file" id="in-batch-tgt" hidden multiple accept="image/*" onchange="app.batch.handleFiles('tgt', this)">
                        </div>
                        <div id="list-batch-tgt" class="batch-list"></div>
                    </div>
                </div>
                <div id="batch-progress" class="progress-container">
                    <div style="color:var(--primary)">PROCESSING MATRIX...</div>
                    <div class="progress-bar-track"><div id="batch-bar" class="progress-bar-fill"></div></div>
                    <div class="progress-stats"><span id="batch-stat-count">0/0</span><span id="batch-stat-pct">0%</span></div>
                </div>
                <button class="btn" style="width:100%; margin-top:20px;" onclick="app.batch.execute()">RUN MATRIX BATCH</button>
                <div id="batch-results" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(100px, 1fr)); gap:10px; margin-top:20px;"></div>
            </div>
        </div>

        <div id="view-video" class="widget-container">
            <div class="panel">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h2>VIDEO SYNTHESIS ENGINE</h2>
                    <span style="font-family: var(--font-mono); font-size: 0.7rem; color: red;">MAX 6 SECONDS</span>
                </div>
                <div class="swap-grid">
                    <div>
                        <label>01 // SOURCE FACE</label>
                        <div class="upload-zone" id="zone-vid-src" onclick="document.getElementById('in-vid-src').click()">
                            <div class="placeholder"><i>üë§</i>SOURCE IMG</div>
                            <img id="img-vid-src">
                            <input type="file" id="in-vid-src" hidden accept="image/*" onchange="app.video.handleSrc(this)">
                        </div>
                    </div>
                    <div>
                        <label>02 // TARGET VIDEO (MP4/WEBM)</label>
                        <div class="upload-zone" id="zone-vid-tgt" onclick="document.getElementById('in-vid-tgt').click()">
                            <div class="placeholder"><i>üé•</i>VIDEO FILE<br>&lt; 6 SECONDS</div>
                            <video id="vid-preview" controls style="max-height:100%; width:100%; display:none;"></video>
                            <input type="file" id="in-vid-tgt" hidden accept="video/*" onchange="app.video.handleTgt(this)">
                        </div>
                    </div>
                </div>
                <div id="vid-progress" class="progress-container">
                    <div style="color:var(--secondary); animation: blink 1s infinite;">>> RENDERING FRAMES...</div>
                    <div class="progress-bar-track"><div id="vid-bar" class="progress-bar-fill"></div></div>
                    <div class="progress-stats">
                        <span id="vid-stat-frame">FRAME: 0/0</span>
                        <span id="vid-stat-eta">ETA: --s</span>
                    </div>
                </div>
                <button class="btn" id="btn-vid-run" style="width:100%; margin-top:20px;" onclick="app.video.execute()">RENDER VIDEO</button>
                <div id="vid-result-area" style="display:none; margin-top:20px; text-align:center;">
                    <h3>OUTPUT VIDEO</h3>
                    <video id="vid-result" controls style="width:100%; border:1px solid var(--primary);"></video>
                    <button class="btn" style="margin-top:10px;" onclick="app.video.download()">DOWNLOAD VIDEO</button>
                    <button class="btn" onclick="app.saveToVault('video')">SAVE TO VAULT</button>
                </div>
            </div>
        </div>

        <div id="view-gif" class="widget-container">
            <div class="panel">
                <h2>AI GIF GENERATOR (DEEP SCAN)</h2>
                <div class="input-group">
                    <label>SEARCH GIFS (TENOR ENGINE)</label>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="gif-search-in" placeholder="E.g., 'excited', 'coding', 'cat'">
                        <button class="btn" style="width:auto;" id="btn-gif-search" onclick="app.gif.search()">SEARCH</button>
                    </div>
                </div>
                <div class="input-group">
                    <label>QUICK ACCESS</label>
                    <div class="gif-tags">
                        <div class="gif-tag" onclick="app.gif.quickSearch('Gif of coding')">üíª Coding</div>
                        <div class="gif-tag" onclick="app.gif.quickSearch('Gif of excited')">üî• Excited</div>
                        <div class="gif-tag" onclick="app.gif.quickSearch('Gif of cat')">üò∫ Cats</div>
                        <div class="gif-tag" onclick="app.gif.quickSearch('Gif of crypto')">üöÄ Crypto</div>
                        <div class="gif-tag" onclick="app.gif.quickSearch('Gif of anime')">üéå Anime</div>
                        <div class="gif-tag" onclick="app.gif.quickSearch('Gif of fail')">ü§¶ Fail</div>
                    </div>
                </div>
                <div id="gif-editor" style="display:none; margin-top:20px; border-top:1px solid #333; padding-top:20px;">
                    <div class="swap-grid">
                        <div style="text-align:center;">
                            <label style="margin-bottom:10px; display:block; color:var(--primary);">>> PREVIEW & EDIT</label>
                            <div class="gif-container">
                                <img id="gif-preview" style="max-width:100%; border:1px solid var(--primary); min-height:200px; background:#111;">
                                <div id="overlay-top" class="gif-text-overlay"></div>
                                <div id="overlay-bot" class="gif-text-overlay"></div>
                            </div>
                        </div>
                        <div style="display:flex; flex-direction:column; justify-content:center; gap:15px;">
                            <div class="input-group">
                                <label>TOP CAPTION</label>
                                <input type="text" id="gif-text-top" placeholder="TYPE HERE..." oninput="app.gif.renderPreview()">
                            </div>
                            <div class="input-group">
                                <label>BOTTOM CAPTION</label>
                                <input type="text" id="gif-text-bot" placeholder="TYPE HERE..." oninput="app.gif.renderPreview()">
                            </div>
                            <p style="font-size:0.7rem; color:#666;">
                                * Text is overlayed visually. Press 'RENDER' to bake text into GIF via backend or 'DOWNLOAD' to save preview.
                            </p>
                            <button class="btn" id="btn-gif-render" onclick="app.gif.applyText()">RENDER TEXT (BACKEND)</button>
                            <button class="btn" onclick="app.gif.download()">DOWNLOAD GIF</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-themes" class="widget-container">
            <div class="panel">
                <h2>ADVANCED THEME MATRIX</h2>
                <div class="theme-browser">
                    <div class="cat-list" id="theme-cats"></div>
                    <div class="sub-cat-view" id="theme-subs"></div>
                </div>
            </div>
        </div>

        <div id="view-vault" class="widget-container">
            <div class="panel">
                <div style="display:flex; justify-content:space-between;">
                    <h2>IDENTITY VAULT</h2>
                    <div>
                        <button class="btn" style="padding:5px 10px; font-size:10px;" onclick="app.showVault('history')">IMAGES</button>
                        <button class="btn" style="padding:5px 10px; font-size:10px;" onclick="app.showVault('video_history')">VIDEOS</button>
                        <button class="btn btn-danger" style="padding:5px 10px; font-size:10px;" onclick="app.clearVault()">PURGE</button>
                    </div>
                </div>
                <div id="vault-grid" class="history-grid" style="margin-top:15px;"></div>
                <p id="vault-empty" style="text-align:center; color:#555; display:none;">// VAULT_EMPTY</p>
            </div>
        </div>

        <div id="view-profile" class="widget-container">
            <div class="panel" style="max-width: 600px; margin: 0 auto;">
                <h2>OPERATOR PROFILE</h2>
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="width: 100px; height: 100px; border-radius: 50%; border: 2px solid var(--primary); margin: 0 auto; overflow: hidden; position: relative;">
                        <img id="profile-avatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23111'/%3E%3Ctext x='50' y='65' fill='%23333' font-size='50' text-anchor='middle' font-family='sans-serif'%3E?%3C/text%3E%3C/svg%3E" style="width:100%; height:100%; object-fit: cover;">
                    </div>
                    <input type="file" id="avatar-up" hidden onchange="app.updateAvatar(this)">
                    <button class="btn" style="margin-top:10px; padding: 5px 15px;" onclick="document.getElementById('avatar-up').click()">UPLOAD AVATAR</button>
                </div>
                <div class="input-group">
                    <label>CODENAME</label>
                    <input type="text" id="username-in" onchange="localStorage.setItem('nf_username', this.value)">
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; text-align:center;">
                    <div style="background:rgba(0,0,0,0.5); padding:10px; border:1px solid #333;">
                        <div style="font-size:2rem; color:var(--primary)" id="stat-swaps">0</div>
                        <div style="font-size:0.6rem; color:#888;">TOTAL OPERATIONS</div>
                    </div>
                    <div style="background:rgba(0,0,0,0.5); padding:10px; border:1px solid #333;">
                        <div style="font-size:2rem; color:var(--secondary)" id="stat-date">0</div>
                        <div style="font-size:0.6rem; color:#888;">DAYS ACTIVE</div>
                    </div>
                </div>
                <button class="btn btn-danger" style="margin-top:20px; width:100%" onclick="localStorage.clear(); location.reload()">FACTORY RESET SYSTEM</button>
            </div>
        </div>

        <div id="view-status" class="widget-container">
            <div class="panel">
                <h2>SYSTEM DIAGNOSTICS</h2>
                <div id="status-log" style="font-family: var(--font-mono); font-size: 0.8rem; background: #000; padding: 15px; height: 300px; overflow-y: auto; border: 1px solid #333; color: var(--text-dim);">
                    <div style="color:var(--primary)">> INITIALIZING DIAGNOSTIC SUBROUTINES...</div>
                </div>
            </div>
        </div>

        <div id="view-about" class="widget-container">
            <div class="panel">
                <h2>ABOUT NOVUSFACE</h2>
                <p>NovusFace AI is an 11D Neural Injection Engine designed for high-fidelity identity reconstruction.</p>
                <ul style="line-height: 1.8; color: var(--text-dim);">
                    <li><strong>Image Engine:</strong> InsightFace + GFPGAN (Restoration)</li>
                    <li><strong>Video Engine:</strong> Frame Tracking + Temporal Smoothing (Beta)</li>
                    <li><strong>Privacy:</strong> Local storage via IndexedDB. No server logs.</li>
                    <li><strong>Version:</strong> 8.0.0 (Ultimate Edition)</li>
                </ul>
            </div>
        </div>

    </main>

    <script>
        const CFG = { api: "https://codewander-666-novusface-backend.hf.space" };
        const $ = (id) => document.getElementById(id);
        const log = (msg, type='info') => {
            const el = document.createElement('div');
            el.innerHTML = `<span style="opacity:0.5">[${new Date().toLocaleTimeString()}]</span> ${msg}`;
            if(type==='err') el.style.color = 'red';
            if(type==='succ') el.style.color = 'var(--primary)';
            $('status-log').appendChild(el);
            $('status-log').scrollTop = $('status-log').scrollHeight;
        };

        const db = {
            conn: null,
            init: async () => {
                return new Promise((resolve, reject) => {
                    const req = indexedDB.open("NovusFace_DB", 3);
                    req.onupgradeneeded = (e) => {
                        const d = e.target.result;
                        if(!d.objectStoreNames.contains('history')) d.createObjectStore('history', {keyPath:'id', autoIncrement:true});
                        if(!d.objectStoreNames.contains('video_history')) d.createObjectStore('video_history', {keyPath:'id', autoIncrement:true});
                        if(!d.objectStoreNames.contains('batch_history')) d.createObjectStore('batch_history', {keyPath:'id', autoIncrement:true});
                        if(!d.objectStoreNames.contains('profile')) d.createObjectStore('profile', {keyPath:'key'});
                    };
                    req.onsuccess = (e) => { db.conn = e.target.result; resolve(); };
                    req.onerror = (e) => reject(e);
                });
            },
            add: (store, data) => {
                const tx = db.conn.transaction(store, 'readwrite');
                tx.objectStore(store).add(data);
                return new Promise(r => tx.oncomplete = r);
            },
            getAll: (store) => {
                return new Promise(resolve => {
                    const items = [];
                    const tx = db.conn.transaction(store, 'readonly');
                    tx.objectStore(store).openCursor(null, 'prev').onsuccess = (e) => {
                        const c = e.target.result;
                        if(c) { items.push(c.value); c.continue(); } else resolve(items);
                    };
                });
            },
            put: (store, data) => {
                const tx = db.conn.transaction(store, 'readwrite');
                tx.objectStore(store).put(data);
            },
            get: (store, key) => {
                return new Promise(resolve => {
                    db.conn.transaction(store, 'readonly').objectStore(store).get(key).onsuccess = e => resolve(e.target.result);
                });
            },
            clearStore: (store) => {
                db.conn.transaction(store, 'readwrite').objectStore(store).clear();
            }
        };

        const anim = {
            ctx: $('anim-canvas').getContext('2d'),
            w: 0, h: 0,
            mode: 0,
            particles: [],
            init: () => {
                window.addEventListener('resize', anim.resize);
                anim.resize();
                anim.loop();
                anim.setMode(0);
            },
            resize: () => {
                $('anim-canvas').width = window.innerWidth;
                $('anim-canvas').height = window.innerHeight;
                anim.w = window.innerWidth;
                anim.h = window.innerHeight;
            },
            setMode: (m) => {
                anim.mode = m;
                anim.particles = [];
                for(let i=0; i<80; i++) {
                    anim.particles.push({
                        x: Math.random() * anim.w, y: Math.random() * anim.h,
                        vx: (Math.random()-0.5), vy: (Math.random()-0.5),
                        size: Math.random() * 3,
                        c: Math.random() > 0.5 ? getComputedStyle(document.body).getPropertyValue('--primary') : '#333'
                    });
                }
            },
            loop: () => {
                const ctx = anim.ctx;
                ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--bg-deep');
                ctx.globalAlpha = 0.1;
                ctx.fillRect(0,0,anim.w,anim.h);
                ctx.globalAlpha = 1;
                anim.particles.forEach(p => {
                    p.x += p.vx; p.y += p.vy;
                    if(p.x<0||p.x>anim.w) p.vx*=-1;
                    if(p.y<0||p.y>anim.h) p.vy*=-1;
                    ctx.fillStyle = p.c;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                    ctx.fill();
                });
                requestAnimationFrame(anim.loop);
            }
        };

        const app = {
            state: { srcFile: null, tgtFile: null, tgtFaceId: 0, resultBlob: null, activeVault: 'history' },
            init: async () => {
                $('global-loader').style.display = 'flex';
                await db.init();
                anim.init();
                
                // Init Themes
                app.themes.init();
                
                // Load Profile
                const user = localStorage.getItem('nf_username');
                if(user) $('username-in').value = user;
                const av = await db.get('profile', 'avatar');
                if(av) $('profile-avatar').src = URL.createObjectURL(av.blob);
                app.updateStats();

                // Auto-Fix Broken Images
                window.addEventListener('error', e => {
                    if(e.target.tagName === 'IMG') e.target.src = 'https://via.placeholder.com/300x300/111/444?text=ERROR';
                }, true);

                setTimeout(() => $('global-loader').style.display = 'none', 1000);
                log("SYSTEM_ONLINE. NEURAL_CORE_READY.", "succ");
            },

            nav: (view) => {
                document.querySelectorAll('.widget-container').forEach(el => el.classList.remove('active'));
                $(`view-${view}`).classList.add('active');
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                event.currentTarget.classList.add('active');
                if(view === 'vault') app.showVault('history');
            },

            // --- GIF MAKER MODULE ---
            gif: {
                currentQuery: "",
                quickSearch: (term) => { $('gif-search-in').value = term; app.gif.search(); },
                search: async () => {
                    const q = $('gif-search-in').value;
                    if(!q) return alert("ENTER QUERY");
                    app.gif.currentQuery = q;
                    const btn = $('btn-gif-search');
                    btn.innerText = "SCANNING..."; btn.disabled = true;
                    try {
                        const prompt = q.toLowerCase().includes('gif') ? q : `Gif of ${q}`;
                        const fd = new FormData(); fd.append('prompt', prompt);
                        const res = await fetch(`${CFG.api}/generate-content`, {method:'POST', body:fd});
                        if(!res.ok) throw new Error("API ERROR");
                        const blob = await res.blob();
                        $('gif-preview').src = URL.createObjectURL(blob);
                        $('gif-editor').style.display = 'block';
                        $('gif-text-top').value = ''; $('gif-text-bot').value = '';
                        app.gif.renderPreview();
                    } catch(e) { alert(e.message); } 
                    finally { btn.innerText = "SEARCH"; btn.disabled = false; }
                },
                renderPreview: () => {
                    $('overlay-top').innerText = $('gif-text-top').value;
                    $('overlay-bot').innerText = $('gif-text-bot').value;
                },
                applyText: async () => {
                    const top = $('gif-text-top').value;
                    const bot = $('gif-text-bot').value;
                    const btn = $('btn-gif-render');
                    btn.innerText = "RENDERING..."; btn.disabled = true;
                    try {
                        let prompt = app.gif.currentQuery;
                        if(!prompt.toLowerCase().includes('gif')) prompt = `Gif of ${prompt}`;
                        if(top) prompt += ` "${top}"`;
                        if(bot) prompt += ` "${bot}"`;
                        const fd = new FormData(); fd.append('prompt', prompt);
                        const res = await fetch(`${CFG.api}/generate-content`, {method:'POST', body:fd});
                        if(!res.ok) throw new Error("RENDER FAILED");
                        const blob = await res.blob();
                        $('gif-preview').src = URL.createObjectURL(blob);
                    } catch(e) { alert(e.message); }
                    finally { btn.innerText = "RENDER TEXT (BACKEND)"; btn.disabled = false; }
                },
                download: () => {
                    const a = document.createElement('a'); a.href = $('gif-preview').src; a.download = 'novus_gif.gif'; a.click();
                }
            },

            // --- THEME MATRIX MODULE ---
            themes: {
                data: {
                    "NEON": { "CYBERPUNK": "cyberpunk", "NEON TOKYO": "neon_tokyo", "SYNTHWAVE": "synthwave" },
                    "NATURE": { "DEEP OCEAN": "deep_ocean", "FOREST KING": "forest_king", "VOLCANO": "volcano" },
                    "MINIMAL": { "OBSIDIAN": "obsidian", "MIDNIGHT": "midnight" }
                },
                init: () => {
                    const cats = Object.keys(app.themes.data);
                    const list = $('theme-cats');
                    cats.forEach((c, i) => {
                        const div = document.createElement('div');
                        div.className = `cat-item ${i===0?'active':''}`;
                        div.innerText = c;
                        div.onclick = () => {
                            document.querySelectorAll('.cat-item').forEach(x=>x.classList.remove('active'));
                            div.classList.add('active');
                            app.themes.renderSubs(c);
                        };
                        list.appendChild(div);
                        if(i===0) app.themes.renderSubs(c);
                    });
                },
                renderSubs: (cat) => {
                    const subs = app.themes.data[cat];
                    const view = $('theme-subs');
                    view.innerHTML = '';
                    const group = document.createElement('div');
                    group.className = 'sub-cat-group';
                    const grid = document.createElement('div');
                    grid.className = 'theme-grid-mini';
                    
                    Object.keys(subs).forEach(name => {
                        const id = subs[name];
                        const card = document.createElement('div');
                        card.className = 'theme-mini';
                        // Generate dynamic preview colors
                        const c1 = '#'+Math.floor(Math.random()*16777215).toString(16);
                        const c2 = '#'+Math.floor(Math.random()*16777215).toString(16);
                        card.innerHTML = `<div class="theme-mini-preview" style="background:linear-gradient(45deg, ${c1}, ${c2})"></div><div class="theme-mini-name">${name}</div>`;
                        card.onclick = () => {
                            document.body.setAttribute('data-theme', id);
                            localStorage.setItem('nf_theme', id);
                        };
                        grid.appendChild(card);
                    });
                    group.appendChild(grid);
                    view.appendChild(group);
                }
            },

            // --- UTILS (SWAP, VIDEO, BATCH, VAULT) ---
            handleUpload: async (type, input) => {
                if(input.files[0]) {
                    const f = input.files[0];
                    $(`img-${type}`).src = URL.createObjectURL(f);
                    $(`zone-${type}`).classList.add('has-media');
                    if(type==='src') app.state.srcFile = f;
                    if(type==='tgt') { app.state.tgtFile = f; await app.detectFaces(f); }
                }
            },
            detectFaces: async (file) => {
                $('loader-text').innerText = "SCANNING TARGET HOSTS...";
                $('global-loader').style.display = 'flex';
                const fd = new FormData(); fd.append('target', file);
                try {
                    const res = await fetch(`${CFG.api}/detect-target-faces`, {method:'POST', body:fd});
                    const data = await res.json();
                    const list = $('face-list'); list.innerHTML = '';
                    $('face-list-container').style.display = 'block';
                    if(data.faces && data.faces.length > 0) {
                        data.faces.forEach((f, i) => {
                            const d = document.createElement('div');
                            d.className = `face-thumb ${i===0?'selected':''}`;
                            d.style.backgroundImage = `url(${f.thumbnail})`;
                            d.onclick = () => {
                                document.querySelectorAll('.face-thumb').forEach(x => x.classList.remove('selected'));
                                d.classList.add('selected');
                                app.state.tgtFaceId = f.face_id;
                            };
                            list.appendChild(d);
                            if(i===0) app.state.tgtFaceId = f.face_id;
                        });
                        log(`TARGET_SCAN: ${data.faces.length} HOSTS.`, "succ");
                    }
                } catch(e) { log("API_ERR", "err"); } finally { $('global-loader').style.display = 'none'; }
            },
            executeSwap: async () => {
                if(!app.state.srcFile || !app.state.tgtFile) return alert("MISSING INPUTS");
                $('loader-text').innerText = "INJECTING NEURAL IDENTITY...";
                $('global-loader').style.display = 'flex';
                const fd = new FormData();
                fd.append('source', app.state.srcFile); fd.append('target', app.state.tgtFile);
                fd.append('target_face_id', app.state.tgtFaceId); fd.append('accuracy_weight', $('rng-acc').value);
                try {
                    const res = await fetch(`${CFG.api}/swap`, {method:'POST', body:fd});
                    const blob = await res.blob();
                    $('img-res').src = URL.createObjectURL(blob);
                    $('result-area').style.display = 'block';
                    app.state.resultBlob = blob;
                    app.incrementStats();
                } catch(e) { log("SWAP_FAIL", "err"); } finally { $('global-loader').style.display = 'none'; }
            },
            downloadResult: () => {
                const a = document.createElement('a'); a.href = URL.createObjectURL(app.state.resultBlob); a.download = 'novus_swap.png'; a.click();
            },
            saveToVault: async (type='image') => {
                if(app.state.resultBlob) {
                    await db.add(type==='video'?'video_history':'history', {blob:app.state.resultBlob, date:Date.now()});
                    log("VAULT_SAVED", "succ");
                }
            },
            showVault: async (store) => {
                app.state.activeVault = store;
                const items = await db.getAll(store);
                const grid = $('vault-grid'); grid.innerHTML = '';
                items.forEach(i => {
                    const d = document.createElement('div'); d.className = 'history-item';
                    const url = URL.createObjectURL(i.blob);
                    d.innerHTML = store==='video_history' ? `<video src="${url}"></video>` : `<img src="${url}">`;
                    grid.appendChild(d);
                });
            },
            clearVault: async () => {
                if(confirm("PURGE VAULT?")) { await db.clearStore(app.state.activeVault); app.showVault(app.state.activeVault); }
            },
            updateAvatar: async (inp) => {
                if(inp.files[0]) { $('profile-avatar').src = URL.createObjectURL(inp.files[0]); await db.put('profile', {key:'avatar', blob:inp.files[0]}); }
            },
            incrementStats: () => {
                localStorage.setItem('nf_swaps', (parseInt(localStorage.getItem('nf_swaps'))||0)+1);
                app.updateStats();
            },
            updateStats: () => {
                $('stat-swaps').innerText = localStorage.getItem('nf_swaps')||0;
            },
            
            // --- VIDEO & BATCH PLACEHOLDERS (Keeping Exact Logic) ---
            batch: {
                handleFiles: (type, inp) => {
                    const list = $(`list-batch-${type}`); list.innerHTML = '';
                    Array.from(inp.files).slice(0, type==='src'?5:10).forEach(f => list.innerHTML += `<div class="batch-item"><span>${f.name}</span></div>`);
                    app.batch[`${type}Files`] = Array.from(inp.files);
                },
                execute: async () => {
                    if(!app.batch.srcFiles?.length) return alert("SELECT FILES");
                    $('batch-progress').style.display = 'block';
                    let c = 0; const t = app.batch.srcFiles.length * app.batch.tgtFiles.length;
                    $('batch-results').innerHTML = '';
                    for(let s of app.batch.srcFiles) {
                        for(let tg of app.batch.tgtFiles) {
                            try {
                                const fd = new FormData(); fd.append('source', s); fd.append('target', tg);
                                const res = await fetch(`${CFG.api}/swap`, {method:'POST', body:fd});
                                if(res.ok) {
                                    const url = URL.createObjectURL(await res.blob());
                                    $('batch-results').innerHTML += `<img src="${url}" style="width:100%">`;
                                }
                            } catch(e){}
                            c++; $('batch-bar').style.width = `${(c/t)*100}%`; $('batch-stat-count').innerText = `${c}/${t}`;
                        }
                    }
                }
            },
            video: {
                handleSrc: (inp) => { if(inp.files[0]) { app.video.srcFile=inp.files[0]; $('img-vid-src').src=URL.createObjectURL(inp.files[0]); $('zone-vid-src').classList.add('has-media'); } },
                handleTgt: (inp) => { 
                    if(inp.files[0]) { 
                        if(inp.files[0].size>50*1024*1024) return alert("TOO LARGE");
                        app.video.tgtFile=inp.files[0]; $('zone-vid-tgt').classList.add('has-media'); 
                    } 
                },
                execute: async () => {
                    if(!app.video.srcFile || !app.video.tgtFile) return alert("MISSING INPUTS");
                    $('vid-progress').style.display='block'; $('btn-vid-run').disabled=true;
                    const fd = new FormData(); fd.append('source', app.video.srcFile); fd.append('target', app.video.tgtFile);
                    try {
                        const res = await fetch(`${CFG.api}/video/process`, {method:'POST', body:fd});
                        const d = await res.json();
                        if(d.error) throw new Error(d.error);
                        const ws = new WebSocket(CFG.api.replace("http","ws")+d.websocket_url);
                        ws.onmessage = msg => {
                            const stat = JSON.parse(msg.data);
                            if(stat.status==='PROCESSING') { $('vid-bar').style.width=`${stat.progress}%`; $('vid-stat-frame').innerText=`${stat.current_frame}/${stat.total_frames}`; }
                            if(stat.status==='COMPLETED') { ws.close(); app.video.finish(d.session_id); }
                        }
                    } catch(e) { alert(e.message); $('btn-vid-run').disabled=false; }
                },
                finish: async (sid) => {
                    const res = await fetch(`${CFG.api}/video/result/${sid}`);
                    const blob = await res.blob();
                    $('vid-result').src = URL.createObjectURL(blob);
                    $('vid-result-area').style.display='block'; $('vid-progress').style.display='none';
                    app.state.resultBlob = blob; $('btn-vid-run').disabled=false;
                },
                download: () => {
                    const a = document.createElement('a'); a.href=$('vid-result').src; a.download='novus_video.mp4'; a.click();
                }
            }
        };

        window.onload = app.init;
    </script>
</body>
</html>
