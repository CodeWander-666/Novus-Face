<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NF // NOVUSFACE INFINITY 11D</title>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%23000'/%3E%3Ctext x='50' y='70' font-family='Orbitron' font-weight='900' font-size='50' fill='%2300ffcc' text-anchor='middle'%3ENF%3C/text%3E%3C/svg%3E">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;900&family=JetBrains+Mono&family=Orbitron:wght@400;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #00ffcc; --bg: #050505; --panel: rgba(10,10,10,0.85);
            --border: 1px solid rgba(255,255,255,0.1); --radius: 12px;
            --rotateX: 0deg; --rotateY: 0deg; --scale: 1; --blur: 15px;
        }

        /* --- 11D THEME ENGINE --- */
        [data-theme="cyber"] { --primary: #00f3ff; --bg: #020508; --radius: 0px; }
        [data-theme="desire"] { --primary: #ff0055; --bg: #120005; --radius: 40px; --blur: 30px; }
        [data-theme="matrix"] { --primary: #00ff00; --bg: #000; --radius: 4px; }
        [data-theme="royal"] { --primary: #d4af37; --bg: #080805; --radius: 20px; }
        [data-theme="vapor"] { --primary: #ff00ff; --bg: #100020; --radius: 15px; }
        [data-theme="glacier"] { --primary: #7df9ff; --bg: #f0faff; --panel: rgba(255,255,255,0.7); }
        [data-theme="solar"] { --primary: #ffaa00; --bg: #101010; --radius: 0px; }
        [data-theme="void"] { --primary: #ffffff; --bg: #000; --radius: 0px; }
        [data-theme="nebula"] { --primary: #9d00ff; --bg: #050010; --radius: 30px; }
        [data-theme="amber"] { --primary: #ffb000; --bg: #0d0a00; --radius: 2px; }
        [data-theme="forest"] { --primary: #00ff88; --bg: #000d05; --radius: 25px; }
        [data-theme="deepsea"] { --primary: #0044ff; --bg: #000510; --radius: 50px; }
        [data-theme="hazard"] { --primary: #ffee00; --bg: #0a0a00; --radius: 0px; }
        [data-theme="crimson"] { --primary: #dc143c; --bg: #0a0000; --radius: 5px; }
        [data-theme="obsidian"] { --primary: #444; --bg: #000; --radius: 0px; }

        body { 
            background: var(--bg); color: #fff; font-family: 'Orbitron', sans-serif; 
            margin: 0; transition: 0.8s cubic-bezier(0.4, 0, 0.2, 1); 
            overflow-x: hidden; perspective: 1000px;
        }

        #bg-canvas { position: fixed; top: 0; left: 0; z-index: -1; filter: blur(2px); }

        .sidebar { 
            position: fixed; top: 0; right: 0; width: 380px; height: 100%; 
            background: rgba(0,0,0,0.95); border-left: var(--border); 
            transform: translateX(100%); transition: 0.5s; z-index: 1000; padding: 25px;
            backdrop-filter: blur(20px);
        }
        .sidebar.active { transform: translateX(0); }

        /* --- 3D INTERFACE CONTAINER --- */
        .container { 
            max-width: 850px; margin: 60px auto; padding: 20px; 
            transform: rotateX(var(--rotateX)) rotateY(var(--rotateY)) scale(var(--scale));
            transition: 0.6s transform ease-out;
        }

        .glass { 
            background: var(--panel); border: var(--border); border-radius: var(--radius); 
            padding: 40px; backdrop-filter: blur(var(--blur));
            box-shadow: 0 0 40px rgba(0,0,0,0.5), inset 0 0 20px rgba(255,255,255,0.05);
            position: relative; overflow: hidden;
        }

        /* --- LOGO & STATUS --- */
        .nf-header { text-align: center; margin-bottom: 40px; }
        .nf-logo-ring { 
            width: 80px; height: 80px; border: 3px solid var(--primary); 
            margin: 0 auto 15px; border-radius: var(--radius);
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem; font-weight: 900; color: var(--primary);
            box-shadow: 0 0 20px var(--primary); animation: pulse 2s infinite;
        }

        /* --- 11D BUTTONS & INPUTS --- */
        .upload-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        .u-box { 
            border: 2px solid rgba(255,255,255,0.05); height: 160px; border-radius: var(--radius);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; position: relative; overflow: hidden; background: rgba(0,0,0,0.4);
            transition: 0.3s;
        }
        .u-box:hover { border-color: var(--primary); transform: translateZ(20px); }
        .u-box img { position: absolute; width: 100%; height: 100%; object-fit: cover; z-index: 2; }

        .btn-exe { 
            width: 100%; padding: 1.5rem; background: var(--primary); color: #000; 
            border: none; border-radius: var(--radius); font-weight: 900; cursor: pointer;
            text-transform: uppercase; letter-spacing: 5px; margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4); transition: 0.3s;
        }
        .btn-exe:hover { letter-spacing: 8px; filter: brightness(1.2); }

        .theme-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 20px; }
        .t-btn { 
            padding: 12px 5px; font-size: 8px; border: 1px solid #222; 
            text-align: center; cursor: pointer; border-radius: var(--radius);
            background: rgba(255,255,255,0.02); font-weight: 900;
        }
        .t-btn:hover { border-color: var(--primary); color: var(--primary); }

        @keyframes pulse { 0% { opacity: 0.8; } 50% { opacity: 1; transform: scale(1.05); } 100% { opacity: 0.8; } }
    </style>
</head>
<body data-theme="cyber">

<canvas id="bg-canvas"></canvas>

<button style="position:fixed; top:25px; right:25px; z-index:1001; background:none; border:none; color:var(--primary); font-size:2rem; cursor:pointer;" onclick="document.getElementById('sidebar').classList.toggle('active')">â–¤</button>

<div class="sidebar" id="sidebar">
    <div class="nf-logo-ring" style="width:50px; height:50px; font-size:1rem;">NF</div>
    <p style="font-size:10px; color:#555;">NEURAL_OPERATOR</p>
    <input type="text" id="opName" style="background:none; border:none; color:var(--primary); font-size:1.2rem; outline:none;" value="NIKHIL_666" onchange="saveName()">

    <p style="font-size:10px; color:#555; margin-top:30px;">NEURAL_VAULT</p>
    <div id="vault" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;"></div>

    <p style="font-size:10px; color:#555; margin-top:30px;">11D DIMENSION_MATRIX</p>
    <div class="theme-grid">
        <div class="t-btn" onclick="setT('cyber', 0, 15)">CYBER_3D</div>
        <div class="t-btn" onclick="setT('desire', 10, 0)">DESIRE_LOOP</div>
        <div class="t-btn" onclick="setT('matrix', 0, 0)">MATRIX_RAIN</div>
        <div class="t-btn" onclick="setT('vapor', -5, -20)">VAPOR_GLITCH</div>
        <div class="t-btn" onclick="setT('royal', 5, 5)">GOLD_REFRACTION</div>
        <div class="t-btn" onclick="setT('glacier', 0, 0)">ICE_SHARD</div>
        <div class="t-btn" onclick="setT('nebula', 15, 15)">DEEP_SPACE</div>
        <div class="t-btn" onclick="setT('forest', -10, 0)">ECO_NEURAL</div>
        <div class="t-btn" onclick="setT('solar', 0, 0)">SOLAR_FLARE</div>
        <div class="t-btn" onclick="setT('deepsea', 0, 0)">ABYSS_DEPTH</div>
        <div class="t-btn" onclick="setT('hazard', 20, -10)">TOXIC_GRID</div>
        <div class="t-btn" onclick="setT('crimson', 0, 30)">BLOOD_PULSE</div>
        <div class="t-btn" onclick="setT('void', 0, 0)">VOID_NULL</div>
        <div class="t-btn" onclick="setT('amber', 5, -5)">AMBER_MONO</div>
        <div class="t-btn" onclick="setT('obsidian', 0, 0)">OBSIDIAN_RAW</div>
    </div>
</div>

<div class="container" id="mainUI">
    <div class="glass">
        <div class="nf-header">
            <div class="nf-logo-ring">NF</div>
            <h2 id="status" style="font-size: 0.7rem; letter-spacing: 10px; color: var(--primary);">>> NEURAL_LINK_STANDBY</h2>
        </div>

        <div class="upload-grid">
            <div class="u-box" onclick="document.getElementById('si').click()">
                <p>SRC_IDENTITY</p>
                <input type="file" id="si" hidden onchange="p(this, 'sp')">
                <img id="sp" style="display:none">
            </div>
            <div class="u-box" onclick="document.getElementById('ti').click()">
                <p>TGT_MEDIA</p>
                <input type="file" id="ti" hidden onchange="hT(this)">
                <img id="tp" style="display:none">
            </div>
        </div>

        <div id="facePick" style="display:none; margin-top:30px;">
            <p style="font-size:10px; color:#555;">TARGET_MAPPING:</p>
            <div id="faceList" style="display:flex; gap:12px; overflow-x:auto; padding:10px 0;"></div>
        </div>

        <button class="btn-exe" onclick="run()">INJECT IDENTITY DNA</button>

        <div id="res" style="display:none; margin-top:40px; text-align:center;">
            <div style="padding:10px; background:#000; display:inline-block; border-radius:var(--radius); border:1px solid var(--primary);">
                <img id="ri" style="max-width:100%; border-radius:calc(var(--radius) - 5px);">
            </div>
            <br>
            <a id="db" class="btn-exe" style="display:inline-block; text-decoration:none; width:auto; padding:15px 40px; margin-top:15px;" download="nf_infinity.png">DOWNLOAD_11D_MEDIA</a>
        </div>
    </div>
</div>

<script>
    const API = "https://codewander-666-novusface-backend.hf.space";
    let fId = 0, db, canvas, ctx, particles = [];

    // --- LOOP ANIMATION ENGINE ---
    canvas = document.getElementById('bg-canvas');
    ctx = canvas.getContext('2d');
    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.onresize = resize; resize();

    function initLoop() {
        particles = [];
        for(let i=0; i<150; i++) particles.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: Math.random()*2, s: Math.random()*0.5 });
    }
    initLoop();

    function draw() {
        ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--bg');
        ctx.fillRect(0,0,canvas.width, canvas.height);
        const color = getComputedStyle(document.body).getPropertyValue('--primary');
        ctx.fillStyle = color;
        particles.forEach(p => {
            ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
            p.y += p.s; if(p.y > canvas.height) p.y = 0;
        });
        requestAnimationFrame(draw);
    }
    draw();

    // --- STORAGE ---
    const req = indexedDB.open("NF11D", 1);
    req.onupgradeneeded = (e) => e.target.result.createObjectStore("h", { keyPath: "id", autoIncrement: true });
    req.onsuccess = (e) => { db = e.target.result; loadVault(); };

    function saveVault(blob) {
        db.transaction("h", "readwrite").objectStore("h").add({ blob }); loadVault();
    }
    function loadVault() {
        const v = document.getElementById('vault'); v.innerHTML = "";
        db.transaction("h").objectStore("h").openCursor(null, "prev").onsuccess = (e) => {
            const c = e.target.result;
            if(c) {
                const u = URL.createObjectURL(c.value.blob);
                const i = document.createElement('div'); i.style="aspect-ratio:1/1; border-radius:5px; overflow:hidden; border:1px solid #222; cursor:pointer;";
                i.innerHTML = `<img src="${u}" style="width:100%; height:100%; object-fit:cover;">`;
                i.onclick = () => { document.getElementById('ri').src=u; document.getElementById('db').href=u; document.getElementById('res').style.display='block'; };
                v.appendChild(i); c.continue();
            }
        };
    }

    // --- CORE LOGIC ---
    function setT(t, rx, ry) { 
        document.body.setAttribute('data-theme', t);
        const ui = document.getElementById('mainUI');
        ui.style.setProperty('--rotateX', rx+'deg');
        ui.style.setProperty('--rotateY', ry+'deg');
    }

    function saveName() { localStorage.setItem('nv_name', document.getElementById('opName').value); }
    window.onload = () => { if(localStorage.getItem('nv_name')) document.getElementById('opName').value = localStorage.getItem('nv_name'); };

    function p(i, id) { if(i.files[0]) { document.getElementById(id).src=URL.createObjectURL(i.files[0]); document.getElementById(id).style.display='block'; } }

    async function hT(i) {
        p(i, 'tp'); const st = document.getElementById('status'); st.innerText = ">> MAPPING_FACE_NODES...";
        const fd = new FormData(); fd.append('target', i.files[0]);
        try {
            const r = await fetch(`${API}/detect-target-faces`, { method: 'POST', body: fd });
            const d = await r.json();
            const l = document.getElementById('faceList'); l.innerHTML = "";
            document.getElementById('facePick').style.display = 'block';
            d.faces.forEach((f, idx) => {
                const div = document.createElement('div'); div.className = `u-box ${idx===0?'selected':''}`;
                div.style = "width:60px; height:60px; border-radius:50%; flex-shrink:0; background-size:cover; border:2px solid transparent;";
                div.style.backgroundImage = `url(${f.thumbnail})`;
                if(idx===0) div.style.borderColor = "var(--primary)";
                div.onclick = () => { fId = f.face_id; document.querySelectorAll('#faceList div').forEach(x=>x.style.borderColor="transparent"); div.style.borderColor="var(--primary)"; };
                l.appendChild(div);
            });
            fId = d.faces[0].face_id; st.innerText = ">> READY_FOR_INJECTION";
        } catch(e) { st.innerText = ">> SCAN_CRITICAL_FAILURE"; }
    }

    async function run() {
        const s = document.getElementById('si').files[0], t = document.getElementById('ti').files[0];
        if(!s || !t) return;
        const st = document.getElementById('status'); st.innerText = ">> INJECTING_DNA...";
        const fd = new FormData(); fd.append('source', s); fd.append('target', t); fd.append('target_face_id', fId);
        try {
            const r = await fetch(`${API}/swap`, { method: 'POST', body: fd });
            const b = await r.blob(); const u = URL.createObjectURL(b);
            document.getElementById('ri').src = u; document.getElementById('db').href = u;
            document.getElementById('res').style.display = 'block';
            st.innerText = ">> INJECTION_COMPLETE"; saveVault(b);
        } catch(e) { st.innerText = ">> LINK_BROKEN"; }
    }
</script>
</body>
</html>
