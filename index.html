<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NF // NOVUSFACE PRO</title>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%23000'/%3E%3Ctext x='50' y='70' font-family='Orbitron' font-weight='900' font-size='50' fill='%2300ffcc' text-anchor='middle'%3ENF%3C/text%3E%3C/svg%3E">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@400;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #00ffcc; --bg: #050505; --panel: rgba(10,10,10,0.9);
            --border: 1px solid rgba(255,255,255,0.1); --radius: 12px; --skew: 0deg;
            --font: 'Orbitron'; --glow: 0 0 10px var(--primary);
        }

        /* --- 15 UNIQUE ARCHITECTURES --- */
        [data-theme="cyber"] { --primary: #00f3ff; --bg: #080c10; --radius: 0px; --skew: -2deg; --font: 'Orbitron'; }
        [data-theme="blood"] { --primary: #ff0033; --bg: #0f0505; --radius: 40px; --skew: 0deg; --font: 'Inter'; }
        [data-theme="matrix"] { --primary: #00ff00; --bg: #000; --radius: 4px; --skew: 0deg; --font: 'JetBrains Mono'; }
        [data-theme="royal"] { --primary: #d4af37; --bg: #0a0a0a; --radius: 50% 20% / 10% 40%; --skew: 1deg; --font: 'Georgia'; }
        [data-theme="vapor"] { --primary: #ff00ff; --bg: #1a0033; --radius: 20px; --skew: 5deg; --font: 'Orbitron'; }
        [data-theme="glacier"] { --primary: #7df9ff; --bg: #f0faff; --panel: rgba(255,255,255,0.8); --border: 1px solid #7df9ff; --radius: 15px; }
        [data-theme="solar"] { --primary: #ffaa00; --bg: #1b1b1b; --radius: 0px; --skew: 0deg; --border: 4px solid var(--primary); }
        [data-theme="forest"] { --primary: #2ecc71; --bg: #0a140f; --radius: 30px; --font: 'Inter'; }
        [data-theme="obsidian"] { --primary: #fff; --bg: #000; --radius: 0px; --glow: none; }
        [data-theme="nebula"] { --primary: #9d00ff; --bg: #0d001a; --radius: 10px; --skew: -5deg; }
        [data-theme="crimson"] { --primary: #dc143c; --bg: #120000; --radius: 0px; }
        [data-theme="oasis"] { --primary: #48D1CC; --bg: #0F2027; --radius: 25px; }
        [data-theme="void"] { --primary: #333; --bg: #000; --radius: 0px; }
        [data-theme="amber"] { --primary: #ffb000; --bg: #1a1200; --radius: 2px; --font: 'JetBrains Mono'; }
        [data-theme="nordic"] { --primary: #A3C1DA; --bg: #1A2634; --radius: 12px; }

        body { background: var(--bg); color: #fff; font-family: var(--font), sans-serif; margin: 0; transition: 0.6s all cubic-bezier(0.23, 1, 0.32, 1); overflow-x: hidden; }
        
        /* --- BRANDING --- */
        .nf-logo { font-family: 'Orbitron'; font-weight: 900; color: var(--primary); font-size: 1.5rem; letter-spacing: -2px; border: 2px solid var(--primary); padding: 5px 10px; display: inline-block; margin-bottom: 10px; box-shadow: var(--glow); }

        /* --- SIDEBAR --- */
        .sidebar { position: fixed; top: 0; right: 0; width: 350px; height: 100%; background: #000; border-left: var(--border); transform: translateX(100%); transition: 0.5s; z-index: 100; padding: 20px; overflow-y: auto; }
        .sidebar.active { transform: translateX(0); }
        .menu-btn { position: fixed; top: 20px; right: 20px; z-index: 101; cursor: pointer; color: var(--primary); font-size: 2rem; background: none; border: none; }

        /* --- MAIN UI --- */
        .container { max-width: 800px; margin: 50px auto; padding: 20px; transform: skewY(var(--skew)); }
        .glass { background: var(--panel); border: var(--border); border-radius: var(--radius); padding: 40px; box-shadow: var(--glow); backdrop-filter: blur(10px); }
        
        .upload-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0; }
        .box { border: 2px dashed #333; height: 140px; border-radius: var(--radius); display: flex; align-items: center; justify-content: center; cursor: pointer; position: relative; overflow: hidden; background: rgba(0,0,0,0.3); }
        .box img { position: absolute; width: 100%; height: 100%; object-fit: cover; }

        .target-thumb { width: 60px; height: 60px; border-radius: var(--radius); border: 2px solid transparent; cursor: pointer; flex-shrink: 0; background-size: cover; }
        .target-thumb.selected { border-color: var(--primary); box-shadow: var(--glow); }

        .btn-exe { width: 100%; padding: 1.2rem; background: var(--primary); color: #000; border: none; border-radius: var(--radius); font-weight: 900; cursor: pointer; letter-spacing: 3px; font-family: var(--font); }
        
        /* --- HISTORY --- */
        .history-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .history-item { aspect-ratio: 1/1; border-radius: var(--radius); border: 1px solid #222; overflow: hidden; cursor: pointer; }
        .history-item img { width: 100%; height: 100%; object-fit: cover; }

        .theme-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; }
        .t-chip { padding: 8px; font-size: 8px; text-align: center; border: 1px solid #333; cursor: pointer; border-radius: var(--radius); }
    </style>
</head>
<body data-theme="cyber">

<button class="menu-btn" onclick="document.getElementById('sidebar').classList.toggle('active')">â–¤</button>

<div class="sidebar" id="sidebar">
    <div class="nf-logo">NF</div>
    <p style="font-size: 10px; color: #555;">OPERATOR: <input type="text" id="opName" style="background:none; border:none; color:var(--primary); outline:none;" value="NIKHIL_666" onchange="localStorage.setItem('nv_name', this.value)"></p>
    
    <p style="font-size: 10px; color: #555; margin-top: 20px;">NEURAL_VAULT</p>
    <div id="history" class="history-grid"></div>

    <p style="font-size: 10px; color: #555; margin-top: 20px;">GEOMETRY_MATRIX</p>
    <div class="theme-grid">
        <div class="t-chip" onclick="setT('origin')">ORIGIN</div>
        <div class="t-chip" onclick="setT('cyber')">CYBER</div>
        <div class="t-chip" onclick="setT('blood')">BLOOD</div>
        <div class="t-chip" onclick="setT('matrix')">MATRIX</div>
        <div class="t-chip" onclick="setT('royal')">ROYAL</div>
        <div class="t-chip" onclick="setT('vapor')">VAPOR</div>
        <div class="t-chip" onclick="setT('solar')">SOLAR</div>
        <div class="t-chip" onclick="setT('forest')">FOREST</div>
        <div class="t-chip" onclick="setT('glacier')">GLACIER</div>
        <div class="t-chip" onclick="setT('obsidian')">VOID</div>
        <div class="t-chip" onclick="setT('nebula')">NEBULA</div>
        <div class="t-chip" onclick="setT('crimson')">CRIMSON</div>
        <div class="t-chip" onclick="setT('oasis')">OASIS</div>
        <div class="t-chip" onclick="setT('amber')">AMBER</div>
        <div class="t-chip" onclick="setT('nordic')">NORDIC</div>
    </div>
</div>

<div class="container">
    <div class="glass">
        <center>
            <div class="nf-logo">NF</div>
            <h2 id="status" style="font-size: 0.6rem; color: var(--primary); letter-spacing: 5px;">>> SYSTEM_IDLE</h2>
        </center>

        <div class="upload-grid">
            <div class="box" onclick="document.getElementById('si').click()">
                <span>SRC_ID</span>
                <input type="file" id="si" hidden onchange="p(this, 'sp')">
                <img id="sp" style="display:none">
            </div>
            <div class="box" onclick="document.getElementById('ti').click()">
                <span>TGT_MEDIA</span>
                <input type="file" id="ti" hidden onchange="hT(this)">
                <img id="tp" style="display:none">
            </div>
        </div>

        <div id="faceSelection" style="display:none; margin-bottom: 20px;">
            <p style="font-size: 10px; color: #555;">SELECT_TARGET_NODE:</p>
            <div id="faceList" style="display:flex; gap:10px; overflow-x:auto;"></div>
        </div>

        <button class="btn-exe" onclick="run()">INJECT IDENTITY</button>

        <div id="res" style="display:none; margin-top: 30px; text-align: center;">
            <img id="ri" style="max-width: 100%; border-radius: var(--radius); border: var(--border);">
            <br>
            <a id="db" class="btn-exe" style="display:inline-block; margin-top:10px; text-decoration:none; width:auto; padding: 10px 30px;" download="nf_swap.png">DOWNLOAD</a>
        </div>
    </div>
</div>

<script>
    const API = "https://codewander-666-novusface-backend.hf.space";
    let fId = 0, db;

    // --- DB STORAGE ---
    const req = indexedDB.open("NFDB", 1);
    req.onupgradeneeded = (e) => e.target.result.createObjectStore("h", { keyPath: "id", autoIncrement: true });
    req.onsuccess = (e) => { db = e.target.result; loadH(); };

    function saveH(blob) {
        const s = db.transaction("h", "readwrite").objectStore("h");
        s.add({ blob }); loadH();
    }

    function loadH() {
        const g = document.getElementById('history'); g.innerHTML = "";
        db.transaction("h").objectStore("h").openCursor(null, "prev").onsuccess = (e) => {
            const c = e.target.result;
            if(c) {
                const u = URL.createObjectURL(c.value.blob);
                const i = document.createElement('div'); i.className="history-item"; i.innerHTML=`<img src="${u}">`;
                i.onclick = () => { document.getElementById('ri').src = u; document.getElementById('db').href = u; document.getElementById('res').style.display='block'; };
                g.appendChild(i); c.continue();
            }
        };
    }

    // --- LOGIC ---
    function setT(t) { document.body.setAttribute('data-theme', t); }
    function p(i, id) { if(i.files[0]) { const u = URL.createObjectURL(i.files[0]); document.getElementById(id).src=u; document.getElementById(id).style.display='block'; } }

    async function hT(i) {
        p(i, 'tp'); const st = document.getElementById('status'); st.innerText = ">> SCANNING_NODES...";
        const fd = new FormData(); fd.append('target', i.files[0]);
        try {
            const r = await fetch(`${API}/detect-target-faces`, { method: 'POST', body: fd });
            const d = await r.json();
            const l = document.getElementById('faceList'); l.innerHTML = "";
            document.getElementById('faceSelection').style.display = 'block';
            d.faces.forEach((f, idx) => {
                const div = document.createElement('div'); div.className=`target-thumb ${idx===0?'selected':''}`;
                div.style.backgroundImage = `url(${f.thumbnail})`;
                div.onclick = () => { fId = f.face_id; document.querySelectorAll('.target-thumb').forEach(t=>t.classList.remove('selected')); div.classList.add('selected'); };
                l.appendChild(div);
            });
            fId = d.faces[0].face_id; st.innerText = ">> NODES_READY";
        } catch(e) { st.innerText = ">> SCAN_FAILED"; }
    }

    async function run() {
        const s = document.getElementById('si').files[0], t = document.getElementById('ti').files[0];
        if(!s || !t) return;
        const st = document.getElementById('status'); st.innerText = ">> INJECTING...";
        const fd = new FormData(); fd.append('source', s); fd.append('target', t); fd.append('target_face_id', fId);
        try {
            const r = await fetch(`${API}/swap`, { method: 'POST', body: fd });
            const b = await r.blob(); const u = URL.createObjectURL(b);
            document.getElementById('ri').src = u; document.getElementById('db').href = u;
            document.getElementById('res').style.display = 'block';
            st.innerText = ">> SUCCESS"; saveH(b);
        } catch(e) { st.innerText = ">> ERROR"; }
    }

    window.onload = () => { if(localStorage.getItem('nv_name')) document.getElementById('opName').value = localStorage.getItem('nv_name'); };
</script>
</body>
</html>
