<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovusFace AI | God Mode Neural Engine</title>
    
    <meta name="description" content="Professional 11D AI Face Swap Engine. High-accuracy neural identity injection with persistent vault and forensic controls.">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%23000'/%3E%3Ctext x='50' y='70' font-family='Orbitron' font-weight='900' font-size='50' fill='%2300ffcc' text-anchor='middle'%3ENF%3C/text%3E%3C/svg%3E">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;900&family=JetBrains+Mono&family=Orbitron:wght@400;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #00ffcc; --bg: #020202; --panel: rgba(5,5,5,0.92);
            --border: 1px solid rgba(0, 255, 204, 0.2); --radius: 12px;
            --glow: 0 0 20px rgba(0, 255, 204, 0.3);
        }

        /* 15 NEURAL DIMENSIONS (THEMES) */
        [data-theme="cyber"] { --primary: #00f3ff; --bg: #000508; --radius: 0px; }
        [data-theme="desire"] { --primary: #ff0055; --bg: #0a0002; --radius: 40px; }
        [data-theme="matrix"] { --primary: #00ff00; --bg: #000; --radius: 0px; }
        [data-theme="royal"] { --primary: #ffd700; --bg: #050500; --radius: 15px; }
        [data-theme="vapor"] { --primary: #ff00ff; --bg: #100020; --radius: 20px; }
        [data-theme="solar"] { --primary: #ffaa00; --bg: #101010; --radius: 0px; }
        [data-theme="glacier"] { --primary: #7df9ff; --bg: #f0ffff; --panel: rgba(255,255,255,0.1); }
        [data-theme="nebula"] { --primary: #9d00ff; --bg: #050010; }
        [data-theme="void"] { --primary: #ffffff; --bg: #000; --radius: 0px; }
        [data-theme="forest"] { --primary: #00ff88; --bg: #000d05; }
        [data-theme="deepsea"] { --primary: #0044ff; --bg: #000510; }
        [data-theme="hazard"] { --primary: #ffee00; --bg: #0a0a00; --radius: 0px; }
        [data-theme="crimson"] { --primary: #dc143c; --bg: #0a0000; }
        [data-theme="amber"] { --primary: #ffb000; --bg: #0d0a00; }
        [data-theme="nordic"] { --primary: #A3C1DA; --bg: #1A2634; }

        body { background: var(--bg); color: #fff; font-family: 'Orbitron', sans-serif; margin: 0; overflow-x: hidden; transition: 0.8s all; perspective: 1500px; }
        #neuralCanvas { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.6; pointer-events: none; }

        /* COMMAND SIDEBAR */
        .sidebar { position: fixed; top: 0; right: 0; width: 380px; height: 100%; background: rgba(0,0,0,0.98); border-left: var(--border); transform: translateX(100%); transition: 0.5s cubic-bezier(0.19, 1, 0.22, 1); z-index: 2000; padding: 30px; backdrop-filter: blur(30px); overflow-y: auto; }
        .sidebar.active { transform: translateX(0); }
        .menu-trigger { position: fixed; top: 30px; right: 30px; z-index: 2001; cursor: pointer; color: var(--primary); font-size: 1.5rem; background: var(--panel); border: var(--border); padding: 10px; transition: 0.3s; }
        .menu-trigger:hover { box-shadow: var(--glow); transform: scale(1.1); }

        /* INTERFACE BOX */
        .container { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .glass { width: 100%; max-width: 850px; background: var(--panel); border: var(--border); border-radius: var(--radius); padding: 50px; box-shadow: var(--glow); transform-style: preserve-3d; will-change: transform; transition: 0.1s linear; }
        
        .nf-logo { border: 2px solid var(--primary); padding: 10px; display: inline-block; font-weight: 900; margin-bottom: 20px; box-shadow: var(--glow); letter-spacing: 5px; }

        /* BIO-REACTIVE UPLOAD BLOCKS (FIXED) */
        .upload-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 30px 0; }
        .u-box { 
            height: 180px; border: 1px solid rgba(255,255,255,0.05); border-radius: var(--radius); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            cursor: pointer !important; position: relative; overflow: hidden; background: rgba(255,255,255,0.02); 
            transition: 0.4s; z-index: 10;
        }
        .u-box:hover { border-color: var(--primary); background: rgba(0, 255, 204, 0.05); transform: translateZ(40px); box-shadow: var(--glow); }
        .u-box p { font-size: 0.7rem; letter-spacing: 3px; pointer-events: none; transition: 0.3s; }
        .u-box:hover p { color: var(--primary); text-shadow: 0 0 10px var(--primary); }
        /* Fix: Images must not block clicks */
        .u-box img { position: absolute; width: 100%; height: 100%; object-fit: cover; z-index: 2; pointer-events: none; opacity: 0; transition: 0.5s; }
        .u-box.ready img { opacity: 1; }

        /* GOD MODE SLIDER */
        .slider-wrap { margin: 25px 0; padding: 15px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); }
        input[type=range] { width: 100%; accent-color: var(--primary); cursor: pointer; height: 5px; }

        /* BUTTONS */
        .btn-god { width: 100%; padding: 1.5rem; background: var(--primary); color: #000; border: none; border-radius: var(--radius); font-weight: 900; cursor: pointer; letter-spacing: 6px; text-transform: uppercase; transition: 0.4s; }
        .btn-god:hover { letter-spacing: 10px; filter: brightness(1.2); box-shadow: 0 0 30px var(--primary); }

        /* VAULT & THEMES */
        .vault-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
        .vault-item { aspect-ratio: 1/1; border: 1px solid #222; overflow: hidden; cursor: pointer; transition: 0.3s; }
        .vault-item:hover { border-color: var(--primary); transform: scale(1.1); box-shadow: var(--glow); }
    </style>
</head>
<body data-theme="cyber">

<canvas id="neuralCanvas"></canvas>
<div class="menu-trigger" onclick="document.querySelector('.sidebar').classList.toggle('active')">â–¤</div>

<div class="sidebar">
    <div class="nf-logo">NF</div>
    <p style="font-size:10px; color:#555;">OPERATOR_ID</p>
    <input type="text" id="opName" style="background:none; border:none; color:var(--primary); font-size:1.5rem; font-family:'Orbitron'; outline:none; border-bottom:1px solid #333; width:100%;" value="GOD_OPERATOR" onchange="saveName()">

    <p style="font-size:10px; color:#555; margin-top:30px;">IDENTITY_VAULT (SOURCE)</p>
    <div id="vault" class="vault-grid"></div>

    <p style="font-size:10px; color:#555; margin-top:30px;">SWAP_GALLERY (HISTORY)</p>
    <div id="history" class="vault-grid"></div>

    <p style="font-size:10px; color:#555; margin-top:30px;">DIMENSION_MATRIX (THEMES)</p>
    <div id="themeList" style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;"></div>
</div>

<div class="container">
    <div class="glass" id="mainUI">
        <center>
            <div class="nf-logo">NF</div>
            <h1 style="font-size: 1.8rem; letter-spacing: 12px; color: var(--primary); margin: 0;">NOVUSFACE AI</h1>
            <p id="status" style="font-size: 0.6rem; color: #666; font-family:'JetBrains Mono'; margin-top: 10px;">>> SYSTEM_ONLINE_READY_FOR_INJECTION</p>
        </center>

        <div class="upload-grid">
            <div class="u-box" onclick="document.getElementById('srcIn').click()">
                <p>SOURCE IDENTITY</p>
                <input type="file" id="srcIn" hidden onchange="handleSrc(this)">
                <img id="sp">
            </div>
            <div class="u-box" onclick="document.getElementById('tgtIn').click()">
                <p>TARGET SCENE</p>
                <input type="file" id="tgtIn" hidden onchange="handleTgt(this)">
                <img id="tp">
            </div>
        </div>

        <div id="selectionArea" style="display:none; margin-bottom: 25px;">
            <p style="font-size: 9px; color: #555;">NEURAL_MAPPING_TARGETS:</p>
            <div id="faceList" style="display:flex; gap:10px; overflow-x:auto; padding:10px 0;"></div>
        </div>

        <div class="slider-wrap">
            <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                <span style="font-size:9px; color:var(--primary); letter-spacing:2px;">FORENSIC_WEIGHT</span>
                <span id="wVal" style="font-size:10px; color:var(--primary); font-family:'JetBrains Mono';">0.70</span>
            </div>
            <input type="range" id="accSlider" min="0" max="1" step="0.05" value="0.70" oninput="document.getElementById('wVal').innerText=this.value">
        </div>

        <button class="btn-god" onclick="runSwap()">GENERATE NEURAL SWAP</button>

        <div id="res" style="display:none; margin-top:40px; text-align:center;">
            <div style="display:inline-block; border:1px solid var(--primary); padding:10px; border-radius:var(--radius);">
                <img id="ri" style="max-width:100%; display:block; border-radius: calc(var(--radius) - 5px);">
            </div>
            <br>
            <a id="db" class="btn-god" style="display:inline-block; width:auto; text-decoration:none; padding:15px 50px; margin-top:20px;" download="novusface_godmode.png">EXTRACT_MEDIA</a>
        </div>
    </div>
</div>

<script>
    const API = "https://codewander-666-novusface-backend.hf.space";
    let fId = 0, db;

    // --- 11D NEURAL BACKGROUND ENGINE ---
    const canvas = document.getElementById('neuralCanvas');
    const ctx = canvas.getContext('2d');
    let pts = [];
    function resz() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.onresize = resz; resz();

    for(let i=0; i<80; i++) pts.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, vx:Math.random()-0.5, vy:Math.random()-0.5});

    function render() {
        ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--bg');
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--primary');
        ctx.lineWidth = 0.5;
        pts.forEach(p => {
            p.x += p.vx; p.y += p.vy;
            if(p.x<0 || p.x>canvas.width) p.vx*=-1; if(p.y<0 || p.y>canvas.height) p.vy*=-1;
            pts.forEach(p2 => {
                let d = Math.hypot(p.x-p2.x, p.y-p2.y);
                if(d<130) { ctx.globalAlpha = 1 - (d/130); ctx.beginPath(); ctx.moveTo(p.x,p.y); ctx.lineTo(p2.x,p2.y); ctx.stroke(); }
            });
        });
        ctx.globalAlpha = 1; requestAnimationFrame(render);
    }
    render();

    // --- PERSISTENCE (INDEXEDDB) ---
    const req = indexedDB.open("NovusFaceGod", 1);
    req.onupgradeneeded = (e) => {
        let d = e.target.result;
        d.createObjectStore("vault", {keyPath:"id", autoIncrement:true});
        d.createObjectStore("history", {keyPath:"id", autoIncrement:true});
    };
    req.onsuccess = (e) => { db = e.target.result; loadVault(); loadHistory(); };

    function saveTo(store, blob) {
        db.transaction(store, "readwrite").objectStore(store).add({blob, date: Date.now()});
        store === "vault" ? loadVault() : loadHistory();
    }

    function loadVault() {
        const v = document.getElementById('vault'); v.innerHTML = "";
        db.transaction("vault").objectStore("vault").openCursor(null, "prev").onsuccess = (e) => {
            const c = e.target.result;
            if(c) {
                const u = URL.createObjectURL(c.value.blob);
                const d = document.createElement('div'); d.className="vault-item"; d.innerHTML=`<img src="${u}" style="width:100%; height:100%; object-fit:cover">`;
                d.onclick = () => { document.getElementById('sp').src=u; document.getElementById('sp').parentNode.classList.add('ready'); window.curSrc = c.value.blob; };
                v.appendChild(d); c.continue();
            }
        };
    }

    function loadHistory() {
        const h = document.getElementById('history'); h.innerHTML = "";
        db.transaction("history").objectStore("history").openCursor(null, "prev").onsuccess = (e) => {
            const c = e.target.result;
            if(c) {
                const u = URL.createObjectURL(c.value.blob);
                const d = document.createElement('div'); d.className="vault-item"; d.innerHTML=`<img src="${u}" style="width:100%; height:100%; object-fit:cover">`;
                d.onclick = () => { document.getElementById('ri').src=u; document.getElementById('db').href=u; document.getElementById('res').style.display='block'; };
                h.appendChild(d); c.continue();
            }
        };
    }

    // --- CORE LOGIC ---
    function saveName() { localStorage.setItem('opName', document.getElementById('opName').value); }
    window.onload = () => { if(localStorage.getItem('opName')) document.getElementById('opName').value = localStorage.getItem('opName'); };

    function handleSrc(i) {
        if(i.files[0]) {
            const u = URL.createObjectURL(i.files[0]);
            document.getElementById('sp').src = u;
            document.getElementById('sp').parentNode.classList.add('ready');
            window.curSrc = i.files[0]; saveTo("vault", i.files[0]);
        }
    }

    async function handleTgt(i) {
        const f = i.files[0];
        document.getElementById('tp').src = URL.createObjectURL(f);
        document.getElementById('tp').parentNode.classList.add('ready');
        document.getElementById('status').innerText = ">> MAPPING_TARGET_NODES...";
        
        const fd = new FormData(); fd.append('target', f);
        try {
            const r = await fetch(`${API}/detect-target-faces`, {method:'POST', body:fd});
            const d = await r.json();
            const list = document.getElementById('faceList'); list.innerHTML = "";
            document.getElementById('selectionArea').style.display = "block";
            d.faces.forEach((face, idx) => {
                const div = document.createElement('div'); div.style="width:55px; height:55px; border-radius:50%; border:3px solid transparent; flex-shrink:0; background-size:cover; cursor:pointer; transition:0.3s;";
                div.style.backgroundImage = `url(${face.thumbnail})`;
                if(idx===0) { div.style.borderColor = "var(--primary)"; div.style.boxShadow = "var(--glow)"; }
                div.onclick = () => { 
                    fId = face.face_id; 
                    document.querySelectorAll('#faceList div').forEach(n=>{ n.style.borderColor="transparent"; n.style.boxShadow="none"; }); 
                    div.style.borderColor="var(--primary)"; div.style.boxShadow="var(--glow)";
                };
                list.appendChild(div);
            });
            fId = d.faces[0].face_id; document.getElementById('status').innerText = ">> NODES_READY";
        } catch(e) { document.getElementById('status').innerText = ">> SCAN_FAILED"; }
    }

    async function runSwap() {
        const s = window.curSrc, t = document.getElementById('tgtIn').files[0], w = document.getElementById('accSlider').value;
        if(!s || !t) return alert("NO IDENTITY DETECTED.");
        document.getElementById('status').innerText = ">> INJECTING_DNA...";
        
        const fd = new FormData(); fd.append('source', s); fd.append('target', t); fd.append('target_face_id', fId); fd.append('accuracy_weight', w);
        try {
            const res = await fetch(`${API}/swap`, {method:'POST', body:fd});
            const b = await res.blob(); const u = URL.createObjectURL(b);
            document.getElementById('ri').src=u; document.getElementById('db').href=u;
            document.getElementById('res').style.display='block';
            document.getElementById('status').innerText = ">> SUCCESSFUL"; saveTo("history", b);
        } catch(e) { document.getElementById('status').innerText = ">> PROCESS_ERROR"; }
    }

    // THEMES & TILT
    const ths = ['cyber','desire','matrix','royal','vapor','solar','glacier','nebula','void','forest','deepsea','hazard','crimson','amber','nordic'];
    ths.forEach(t => { document.getElementById('themeList').innerHTML += `<div style="padding:10px; border:1px solid #222; cursor:pointer; font-size:9px; text-align:center; transition:0.2s;" onmouseover="this.style.borderColor='var(--primary)'" onmouseout="this.style.borderColor='#222'" onclick="document.body.setAttribute('data-theme','${t}')">${t.toUpperCase()}</div>`; });

    document.addEventListener('mousemove', (e) => {
        let x = (window.innerWidth / 2 - e.pageX) / 45;
        let y = (window.innerHeight / 2 - e.pageY) / 45;
        document.getElementById('mainUI').style.transform = `rotateY(${x}deg) rotateX(${y}deg)`;
    });
</script>
</body>
</html>
