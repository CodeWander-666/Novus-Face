<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovusFace AI | Professional Online Face Swap & Neural Engine</title>
    
    <meta name="description" content="Professional AI Face Swap Engine with 11D Neural Effects. Secure, high-accuracy portrait generation with Forensic Lock verification.">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%23000'/%3E%3Ctext x='50' y='70' font-family='Orbitron' font-weight='900' font-size='50' fill='%2300ffcc' text-anchor='middle'%3ENF%3C/text%3E%3C/svg%3E">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=JetBrains+Mono&family=Orbitron:wght@400;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #00ffcc; --bg: #050505; --panel: rgba(10,10,10,0.92);
            --border: 1px solid rgba(255,255,255,0.1); --radius: 12px;
            --rotateX: 0deg; --rotateY: 0deg; --glow: 0 0 15px var(--primary);
        }

        /* 15 UNIQUE 11D THEMES */
        [data-theme="cyber"] { --primary: #00f3ff; --bg: #05080a; --radius: 0px; }
        [data-theme="desire"] { --primary: #ff0055; --bg: #120005; --radius: 40px; }
        [data-theme="matrix"] { --primary: #00ff00; --bg: #000; --radius: 4px; }
        [data-theme="royal"] { --primary: #d4af37; --bg: #0a0a0a; --radius: 20px; }
        [data-theme="vapor"] { --primary: #ff00ff; --bg: #1a0033; --radius: 15px; }
        [data-theme="glacier"] { --primary: #7df9ff; --bg: #f0faff; --panel: rgba(255,255,255,0.7); }
        [data-theme="solar"] { --primary: #ffaa00; --bg: #101010; --radius: 0px; }
        [data-theme="nebula"] { --primary: #9d00ff; --bg: #050010; --radius: 30px; }
        [data-theme="forest"] { --primary: #00ff88; --bg: #000d05; --radius: 25px; }
        [data-theme="deepsea"] { --primary: #0044ff; --bg: #000510; }
        [data-theme="hazard"] { --primary: #ffee00; --bg: #0a0a0a; --radius: 0px; }
        [data-theme="crimson"] { --primary: #dc143c; --bg: #0a0000; }
        [data-theme="amber"] { --primary: #ffb000; --bg: #0d0a00; }
        [data-theme="void"] { --primary: #ffffff; --bg: #000; --radius: 0px; }
        [data-theme="nordic"] { --primary: #A3C1DA; --bg: #1A2634; }

        body { background: var(--bg); color: #fff; font-family: 'Orbitron', sans-serif; margin: 0; transition: 0.8s all; overflow-x: hidden; perspective: 1200px; }
        #neuralCanvas { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.5; pointer-events: none; }

        /* SIDEBAR & PROFILE */
        .sidebar { position: fixed; top: 0; right: 0; width: 380px; height: 100%; background: rgba(0,0,0,0.96); border-left: var(--border); transform: translateX(100%); transition: 0.5s cubic-bezier(0.16, 1, 0.3, 1); z-index: 1000; padding: 25px; backdrop-filter: blur(20px); overflow-y: auto; }
        .sidebar.active { transform: translateX(0); }
        .menu-btn { position: fixed; top: 25px; right: 25px; z-index: 1001; cursor: pointer; color: var(--primary); font-size: 1.8rem; background: none; border: none; }

        /* UI CONTAINERS */
        .container { max-width: 850px; margin: 60px auto; padding: 20px; transition: 0.1s transform ease-out; }
        .glass { background: var(--panel); border: var(--border); border-radius: var(--radius); padding: 40px; box-shadow: var(--glow); position: relative; transform-style: preserve-3d; }
        
        .nf-logo { border: 2px solid var(--primary); padding: 10px; display: inline-block; font-weight: 900; margin-bottom: 20px; box-shadow: var(--glow); text-transform: uppercase; }

        /* UPLOAD & CONTROLS */
        .upload-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0; }
        .u-box { border: 1px solid #333; height: 160px; border-radius: var(--radius); display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; position: relative; overflow: hidden; background: rgba(0,0,0,0.4); transition: 0.3s; }
        .u-box:hover { border-color: var(--primary); transform: translateZ(20px); }
        .u-box img { position: absolute; width: 100%; height: 100%; object-fit: cover; z-index: 2; }

        .btn-pro { width: 100%; padding: 1.5rem; background: var(--primary); color: #000; border: none; border-radius: var(--radius); font-weight: 900; cursor: pointer; letter-spacing: 5px; text-transform: uppercase; transition: 0.3s; }
        .btn-pro:hover { letter-spacing: 8px; filter: brightness(1.2); }

        /* VAULT & THEME GRID */
        .vault-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 10px; }
        .vault-item { aspect-ratio: 1/1; border-radius: 8px; border: 1px solid #222; overflow: hidden; cursor: pointer; }
        .theme-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        .t-btn { padding: 10px 5px; font-size: 8px; border: 1px solid #333; text-align: center; cursor: pointer; border-radius: 4px; font-weight: 900; background: rgba(255,255,255,0.02); }
        .t-btn:hover { border-color: var(--primary); color: var(--primary); }
    </style>
</head>
<body data-theme="cyber">

<canvas id="neuralCanvas"></canvas>
<button class="menu-btn" onclick="document.getElementById('sidebar').classList.toggle('active')">â–¤</button>

<div class="sidebar" id="sidebar">
    <div class="nf-logo">NF</div>
    <p style="font-size:10px; color:#555; letter-spacing: 2px;">OPERATOR_PROFILE</p>
    <input type="text" id="opName" style="background:none; border:none; color:var(--primary); font-size:1.2rem; outline:none; border-bottom: 1px dashed var(--primary); width: 100%;" value="NIKHIL_SINGH" onchange="saveName()">

    <p style="font-size:10px; color:#555; margin-top:30px; letter-spacing: 2px;">IDENTITY_VAULT (SOURCE FACES)</p>
    <div id="vault" class="vault-grid"></div>

    <p style="font-size:10px; color:#555; margin-top:30px; letter-spacing: 2px;">NEURAL_HISTORY (PREVIOUS SWAPS)</p>
    <div id="history" class="vault-grid"></div>

    <p style="font-size:10px; color:#555; margin-top:30px; letter-spacing: 2px;">11D_AESTHETIC_MATRIX</p>
    <div class="theme-grid" id="themeList"></div>
</div>

<div class="container" id="mainUI">
    <div class="glass">
        <center>
            <div class="nf-logo">NF</div>
            <h1 style="font-size: 1.6rem; letter-spacing: 10px; color: var(--primary); margin: 0;">NOVUSFACE AI</h1>
            <p id="status" style="font-size: 0.6rem; color: #666; font-family:'JetBrains Mono'; margin-top: 10px;">>> STANDBY_FOR_NEURAL_LINK</p>
        </center>

        <div class="upload-grid">
            <div class="u-box" onclick="document.getElementById('srcIn').click()">
                <p style="font-size: 0.7rem; letter-spacing: 2px;">1. UPLOAD SOURCE FACE</p>
                <input type="file" id="srcIn" hidden onchange="handleSrcPreview(this)">
                <img id="sp" style="display:none">
            </div>
            <div class="u-box" onclick="document.getElementById('tgtIn').click()">
                <p style="font-size: 0.7rem; letter-spacing: 2px;">2. UPLOAD TARGET MEDIA</p>
                <input type="file" id="tgtIn" hidden onchange="handleTgtUpload(this)">
                <img id="tp" style="display:none">
            </div>
        </div>

        <div id="facePick" style="display:none; margin-bottom: 25px; border-top: 1px solid #222; padding-top: 20px;">
            <p style="font-size: 10px; color: #555; letter-spacing: 1px;">SELECT TARGET FACE INDEX:</p>
            <div id="faceList" style="display:flex; gap:12px; overflow-x:auto; padding: 10px 0;"></div>
        </div>

        <button class="btn-pro" onclick="executeSwap()">GENERATE FACE SWAP</button>

        <div id="res" style="display:none; margin-top:40px; text-align:center;">
            <div style="display: inline-block; padding: 10px; background: #000; border: 1px solid var(--primary); border-radius: var(--radius);">
                <img id="ri" style="max-width:100%; border-radius: calc(var(--radius) - 4px);">
            </div>
            <br>
            <a id="db" class="btn-pro" style="display:inline-block; margin-top:15px; text-decoration:none; width:auto; padding:15px 40px;" download="novusface_ai_result.png">DOWNLOAD_MEDIA</a>
        </div>
    </div>
</div>

<script>
    const API = "https://codewander-666-novusface-backend.hf.space";
    let selectedFaceId = 0, db;

    // --- RECTIVE NEURAL BACKGROUND ENGINE ---
    const canvas = document.getElementById('neuralCanvas');
    const ctx = canvas.getContext('2d');
    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.onresize = resize; resize();
    
    let particles = [];
    for(let i=0; i<70; i++) particles.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, vx:Math.random()*0.6-0.3, vy:Math.random()*0.6-0.3});

    function animate() {
        ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--bg');
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--primary');
        ctx.lineWidth = 0.5;
        particles.forEach(p => {
            p.x += p.vx; p.y += p.vy;
            if(p.x<0 || p.x>canvas.width) p.vx*=-1; if(p.y<0 || p.y>canvas.height) p.vy*=-1;
            ctx.beginPath(); ctx.arc(p.x, p.y, 1.5, 0, Math.PI*2); ctx.fill();
            particles.forEach(p2 => {
                let d = Math.hypot(p.x-p2.x, p.y-p2.y);
                if(d<100) { ctx.globalAlpha = 1 - (d/100); ctx.beginPath(); ctx.moveTo(p.x,p.y); ctx.lineTo(p2.x,p2.y); ctx.stroke(); }
            });
        });
        ctx.globalAlpha = 1;
        requestAnimationFrame(animate);
    }
    animate();

    // --- PERSISTENT DATA (INDEXEDDB) ---
    const request = indexedDB.open("NovusFaceDB", 1);
    request.onupgradeneeded = (e) => {
        let d = e.target.result;
        d.createObjectStore("vault", { keyPath: "id", autoIncrement: true });
        d.createObjectStore("history", { keyPath: "id", autoIncrement: true });
    };
    request.onsuccess = (e) => { db = e.target.result; loadVault(); loadHistory(); };

    function saveToStore(storeName, blob) {
        db.transaction(storeName, "readwrite").objectStore(storeName).add({ blob, time: new Date().getTime() });
        storeName === "vault" ? loadVault() : loadHistory();
    }

    function loadVault() {
        const v = document.getElementById('vault'); v.innerHTML = "";
        db.transaction("vault").objectStore("vault").openCursor(null, "prev").onsuccess = (e) => {
            const c = e.target.result;
            if(c) {
                const u = URL.createObjectURL(c.value.blob);
                const div = document.createElement('div'); div.className="vault-item"; div.innerHTML=`<img src="${u}" style="width:100%; height:100%; object-fit:cover">`;
                div.onclick = () => { document.getElementById('sp').src=u; document.getElementById('sp').style.display='block'; window.currentSrc = c.value.blob; };
                v.appendChild(div); c.continue();
            }
        };
    }

    function loadHistory() {
        const h = document.getElementById('history'); h.innerHTML = "";
        db.transaction("history").objectStore("history").openCursor(null, "prev").onsuccess = (e) => {
            const c = e.target.result;
            if(c) {
                const u = URL.createObjectURL(c.value.blob);
                const div = document.createElement('div'); div.className="vault-item"; div.innerHTML=`<img src="${u}" style="width:100%; height:100%; object-fit:cover">`;
                div.onclick = () => { document.getElementById('ri').src=u; document.getElementById('db').href=u; document.getElementById('res').style.display='block'; };
                h.appendChild(div); c.continue();
            }
        };
    }

    // --- APP CORE LOGIC ---
    function saveName() { localStorage.setItem('nvName', document.getElementById('opName').value); }
    function setTheme(t) { document.body.setAttribute('data-theme', t); }

    function handleSrcPreview(input) {
        if(input.files[0]) {
            const u = URL.createObjectURL(input.files[0]);
            document.getElementById('sp').src = u;
            document.getElementById('sp').style.display = 'block';
            window.currentSrc = input.files[0];
            saveToStore('vault', input.files[0]);
        }
    }

    async function handleTgtUpload(input) {
        const file = input.files[0];
        document.getElementById('tp').src = URL.createObjectURL(file);
        document.getElementById('tp').style.display = 'block';
        document.getElementById('status').innerText = ">> SCANNING_TARGET_NODES...";
        
        const fd = new FormData(); fd.append('target', file);
        try {
            const res = await fetch(`${API}/detect-target-faces`, { method: 'POST', body: fd });
            const data = await res.json();
            const list = document.getElementById('faceList'); list.innerHTML = "";
            document.getElementById('facePick').style.display = 'block';
            data.faces.forEach((f, i) => {
                const div = document.createElement('div'); div.style="width:55px; height:55px; border-radius:50%; border:2px solid transparent; flex-shrink:0; background-size:cover;";
                div.style.backgroundImage = `url(${f.thumbnail})`;
                if(i===0) div.style.borderColor = "var(--primary)";
                div.onclick = () => { selectedFaceId = f.face_id; document.querySelectorAll('#faceList div').forEach(x=>x.style.borderColor="transparent"); div.style.borderColor="var(--primary)"; };
                list.appendChild(div);
            });
            selectedFaceId = data.faces[0].face_id;
            document.getElementById('status').innerText = ">> MAPPING_COMPLETE";
        } catch(e) { document.getElementById('status').innerText = ">> ERROR_SCANNING"; }
    }

    async function executeSwap() {
        const src = window.currentSrc, tgt = document.getElementById('tgtIn').files[0];
        if(!src || !tgt) return alert("Please upload Source and Target first.");
        document.getElementById('status').innerText = ">> INJECTING_NEURAL_DNA...";
        
        const fd = new FormData(); fd.append('source', src); fd.append('target', tgt); fd.append('target_face_id', selectedFaceId);
        try {
            const res = await fetch(`${API}/swap`, { method: 'POST', body: fd });
            const blob = await res.blob(); const url = URL.createObjectURL(blob);
            document.getElementById('ri').src=url; document.getElementById('db').href=url;
            document.getElementById('res').style.display='block';
            document.getElementById('status').innerText = ">> SUCCESSFUL_SWAP";
            saveToStore('history', blob);
        } catch(e) { document.getElementById('status').innerText = ">> FAILED_PROCESS"; }
    }

    // INIT THEMES
    const themes = ['cyber','desire','matrix','royal','glacier','solar','vapor','nebula','forest','void','amber','crimson','nordic','hazard','deepsea'];
    const tl = document.getElementById('themeList');
    themes.forEach(t => { tl.innerHTML += `<div class="t-btn" onclick="setTheme('${t}')">${t.toUpperCase()}</div>`; });

    // 3D PARALLAX EFFECT
    document.addEventListener('mousemove', (e) => {
        let x = (window.innerWidth / 2 - e.pageX) / 45;
        let y = (window.innerHeight / 2 - e.pageY) / 45;
        document.querySelector('.glass').style.transform = `rotateY(${x}deg) rotateX(${y}deg)`;
    });

    window.onload = () => { if(localStorage.getItem('nvName')) document.getElementById('opName').value = localStorage.getItem('nvName'); };
</script>
</body>
</html>
